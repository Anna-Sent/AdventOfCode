package advent2021

import utils.Point3D
import java.util.*

val INPUT_2021_19_1 = """
            --- scanner 0 ---
            404,-588,-901
            528,-643,409
            -838,591,734
            390,-675,-793
            -537,-823,-458
            -485,-357,347
            -345,-311,381
            -661,-816,-575
            -876,649,763
            -618,-824,-621
            553,345,-567
            474,580,667
            -447,-329,318
            -584,868,-557
            544,-627,-890
            564,392,-477
            455,729,728
            -892,524,684
            -689,845,-530
            423,-701,434
            7,-33,-71
            630,319,-379
            443,580,662
            -789,900,-551
            459,-707,401

            --- scanner 1 ---
            686,422,578
            605,423,415
            515,917,-361
            -336,658,858
            95,138,22
            -476,619,847
            -340,-569,-846
            567,-361,727
            -460,603,-452
            669,-402,600
            729,430,532
            -500,-761,534
            -322,571,750
            -466,-666,-811
            -429,-592,574
            -355,545,-477
            703,-491,-529
            -328,-685,520
            413,935,-424
            -391,539,-444
            586,-435,557
            -364,-763,-893
            807,-499,-711
            755,-354,-619
            553,889,-390

            --- scanner 2 ---
            649,640,665
            682,-795,504
            -784,533,-524
            -644,584,-595
            -588,-843,648
            -30,6,44
            -674,560,763
            500,723,-460
            609,671,-379
            -555,-800,653
            -675,-892,-343
            697,-426,-610
            578,704,681
            493,664,-388
            -671,-858,530
            -667,343,800
            571,-461,-707
            -138,-166,112
            -889,563,-600
            646,-828,498
            640,759,510
            -630,509,768
            -681,-892,-333
            673,-379,-804
            -742,-814,-386
            577,-820,562

            --- scanner 3 ---
            -589,542,597
            605,-692,669
            -500,565,-823
            -660,373,557
            -458,-679,-417
            -488,449,543
            -626,468,-788
            338,-750,-386
            528,-832,-391
            562,-778,733
            -938,-730,414
            543,643,-506
            -524,371,-870
            407,773,750
            -104,29,83
            378,-903,-323
            -778,-728,485
            426,699,580
            -438,-605,-362
            -469,-447,-387
            509,732,623
            647,635,-688
            -868,-804,481
            614,-800,639
            595,780,-596

            --- scanner 4 ---
            727,592,562
            -293,-554,779
            441,611,-461
            -714,465,-776
            -743,427,-804
            -660,-479,-426
            832,-632,460
            927,-485,-438
            408,393,-506
            466,436,-512
            110,16,151
            -258,-428,682
            -393,719,612
            -211,-452,876
            808,-476,-593
            -575,615,604
            -485,667,467
            -680,325,-822
            -627,-443,-432
            872,-547,-609
            833,512,582
            807,604,487
            839,-516,451
            891,-625,532
            -652,-548,-490
            30,-46,-14
    """.trimIndent()

val INPUT_2021_19_2 = """
            --- scanner 0 ---
            878,-830,-633
            -654,579,583
            -297,520,-671
            -288,418,-607
            927,-707,-599
            834,-770,492
            65,-56,25
            662,392,-584
            -635,672,759
            -286,-837,-550
            943,-732,-680
            868,-851,577
            845,-735,422
            757,441,-546
            417,377,639
            -422,-920,-556
            -379,503,-529
            -358,-887,-535
            -557,695,590
            -469,-715,623
            421,350,460
            727,244,-543
            -524,-657,716
            530,386,541
            -516,-654,485

            --- scanner 1 ---
            -576,568,-812
            657,415,-415
            697,-697,-764
            -768,-701,-757
            133,21,23
            660,-634,-685
            531,764,612
            -693,-514,675
            625,435,-393
            -505,429,-811
            -732,-827,-754
            -751,-553,759
            585,424,-332
            406,869,566
            -345,414,781
            -452,446,-773
            437,881,577
            -667,-527,862
            592,-509,865
            572,-544,667
            796,-712,-731
            -466,394,764
            -793,-859,-721
            -424,469,687
            546,-522,796

            --- scanner 2 ---
            496,419,871
            517,-648,-341
            -373,-342,699
            610,-470,865
            -405,433,-478
            635,-489,683
            591,-554,-342
            -523,457,-377
            480,382,833
            -383,339,809
            796,849,-470
            576,-541,-376
            -529,382,821
            -359,-444,565
            -657,-489,-782
            -660,462,-493
            -701,-484,-738
            -444,333,689
            736,800,-551
            440,430,856
            -749,-542,-720
            628,771,-522
            -84,45,31
            -354,-473,697
            655,-447,812

            --- scanner 3 ---
            -585,-799,-407
            -8,3,-15
            -352,263,-798
            648,-897,-545
            807,594,858
            949,398,-473
            -550,462,970
            939,-728,848
            923,450,-605
            -370,-983,687
            -320,-899,708
            -678,-623,-426
            -701,-792,-504
            134,-80,61
            -425,479,834
            651,-666,-537
            906,-869,727
            906,647,784
            -301,457,941
            709,-759,-592
            -338,-971,589
            -326,308,-768
            -271,271,-719
            957,-780,619
            905,310,-592
            902,471,898

            --- scanner 4 ---
            -344,-650,707
            -19,-55,-144
            -475,295,231
            -790,471,-694
            634,400,-574
            -387,-696,643
            526,-976,-868
            737,-562,293
            -362,-790,-599
            649,528,271
            783,305,-610
            -348,-610,641
            827,579,241
            649,-550,431
            20,-194,-1
            -548,230,315
            726,671,262
            -513,246,239
            699,-549,494
            601,-874,-967
            621,381,-566
            600,-977,-919
            -756,576,-753
            -389,-745,-695
            -411,-777,-544
            -712,472,-707

            --- scanner 5 ---
            -736,-631,547
            489,543,-764
            -658,-613,524
            -765,344,314
            474,-482,585
            -588,530,-365
            -589,305,-401
            443,401,516
            376,-573,506
            594,481,-777
            -688,-591,744
            -519,362,-375
            -728,347,358
            442,-612,670
            -657,447,279
            434,-736,-722
            645,623,-783
            -13,-133,-116
            -758,-472,-812
            -651,-534,-759
            -805,-505,-654
            418,-677,-730
            407,437,584
            -149,-18,22
            485,-643,-827
            272,461,520

            --- scanner 6 ---
            457,-689,-751
            394,-366,777
            7,-79,-26
            -346,-410,-447
            492,343,394
            64,50,92
            -432,487,345
            328,-665,-703
            329,-753,-802
            -568,-783,674
            -347,611,-432
            -361,477,-330
            508,305,431
            -628,-604,616
            -504,-588,665
            452,320,442
            -425,-374,-325
            667,364,-435
            -465,-527,-427
            647,493,-477
            391,-438,763
            -517,355,394
            345,-455,661
            -371,367,351
            622,311,-458
            -342,479,-461

            --- scanner 7 ---
            240,-368,494
            553,641,-895
            -844,-774,775
            -158,152,27
            604,463,-925
            -808,-665,694
            257,746,637
            -582,876,794
            -564,874,680
            295,-496,433
            502,-255,-850
            -524,591,-672
            336,-262,-791
            -887,-673,-732
            496,-283,-694
            276,755,723
            233,780,826
            -537,896,707
            -16,-5,-83
            -869,-640,-763
            292,-328,445
            -525,641,-735
            -817,-778,596
            -959,-707,-833
            -537,553,-873
            696,564,-904

            --- scanner 8 ---
            -138,-81,-56
            441,422,-748
            -613,-753,-567
            -711,-766,-679
            471,430,517
            469,-785,640
            -736,-746,-682
            -467,333,-521
            -837,485,476
            574,-437,-615
            -838,-845,533
            436,232,537
            454,235,-722
            630,-503,-471
            -869,-867,440
            -875,-814,670
            449,301,491
            -942,531,351
            -487,316,-400
            477,-764,674
            480,338,-806
            569,-466,-398
            -954,520,382
            -542,410,-479
            539,-822,685

            --- scanner 9 ---
            467,-625,-603
            -669,564,-709
            -847,-826,-623
            652,-665,691
            -836,-756,-658
            555,-658,807
            -738,641,-734
            -640,530,-730
            -532,-707,498
            467,444,-799
            261,397,458
            -419,-609,489
            -490,820,347
            522,-532,-545
            454,584,-817
            -557,750,437
            586,532,-843
            -870,-671,-739
            514,-763,-542
            -524,719,419
            -98,20,18
            -423,-788,462
            340,405,377
            291,442,432
            633,-489,784

            --- scanner 10 ---
            716,-305,-787
            837,-330,-928
            888,-497,410
            -835,-736,-589
            -726,396,-816
            105,27,-108
            -269,644,397
            -783,-776,-540
            -719,467,-739
            -739,-842,696
            -8,-46,23
            683,628,-464
            -579,-821,599
            -354,666,310
            393,435,700
            912,-501,603
            714,514,-397
            810,-320,-849
            487,494,578
            -339,704,339
            895,-524,455
            -704,404,-846
            424,551,688
            -780,-608,-528
            692,689,-364
            -573,-849,755

            --- scanner 11 ---
            -324,527,757
            608,-702,-558
            429,818,379
            582,-495,715
            -341,737,-607
            -796,-621,820
            -880,-642,770
            -868,-740,802
            597,-658,-369
            -453,503,805
            572,409,-620
            560,-388,839
            565,-359,590
            -483,-797,-347
            536,-739,-501
            -390,826,-723
            -387,754,-709
            508,604,-611
            -41,-143,24
            -418,-868,-393
            -325,439,856
            36,43,-57
            469,665,481
            350,782,501
            -394,-779,-323
            632,588,-562

            --- scanner 12 ---
            -866,-426,-688
            486,-659,807
            -935,-385,-780
            -686,-505,394
            662,-480,-583
            816,333,564
            534,365,-598
            -696,619,400
            767,325,526
            -694,783,523
            757,-516,-732
            391,356,-675
            -924,-312,-703
            -50,27,6
            591,-600,841
            590,-613,763
            -723,-341,410
            483,335,-776
            -424,345,-345
            -685,728,577
            681,-472,-570
            -557,-447,419
            832,409,599
            -370,343,-406
            -382,333,-397

            --- scanner 13 ---
            -578,-856,613
            -609,-874,646
            744,-939,-717
            473,-481,439
            -508,-946,680
            792,-836,-716
            391,419,-696
            -38,-154,-175
            499,-592,313
            -550,349,235
            -491,515,228
            -416,617,-490
            382,488,294
            399,438,-683
            -437,709,-591
            435,343,-534
            -105,-7,-65
            475,517,354
            -647,509,256
            -606,-512,-668
            -669,-511,-618
            362,514,220
            693,-938,-791
            -446,566,-668
            -468,-524,-580
            556,-552,297

            --- scanner 14 ---
            -757,815,582
            -2,58,9
            -515,-401,595
            -371,445,-483
            637,752,-662
            8,-94,-131
            723,-646,-779
            -582,817,681
            655,514,402
            -453,-455,594
            -442,-349,665
            -521,-349,-553
            -393,472,-510
            -487,-325,-364
            616,678,468
            615,532,-632
            746,593,500
            -391,490,-396
            585,-819,511
            597,555,-710
            -512,-368,-467
            492,-714,460
            551,-722,444
            756,-804,-732
            -696,826,735
            694,-751,-625

            --- scanner 15 ---
            -643,847,-354
            -766,752,-394
            757,394,440
            799,-393,-663
            -538,-714,742
            -634,-605,-282
            -165,88,-1
            -819,851,-468
            -629,-356,-311
            727,-375,-544
            256,-339,516
            -419,-694,859
            749,586,347
            811,-425,-565
            -498,-816,895
            255,-438,604
            697,851,-525
            556,884,-404
            788,442,416
            -651,-480,-418
            -923,489,752
            -970,419,912
            608,902,-633
            -894,449,783
            -49,-39,90
            384,-390,580

            --- scanner 16 ---
            469,-678,693
            -644,-431,470
            -57,-144,57
            392,324,928
            553,371,-753
            -875,-821,-277
            432,-606,750
            -621,243,-576
            -606,-460,455
            -906,725,820
            -682,343,-567
            -759,-809,-308
            481,-761,-382
            382,-776,-415
            -816,-699,-371
            -914,695,842
            593,360,-814
            374,413,904
            -159,-10,163
            -796,276,-598
            -666,-518,385
            513,-667,882
            303,348,858
            518,-698,-461
            -843,618,835
            521,351,-731

            --- scanner 17 ---
            353,635,-713
            -771,-279,699
            -474,769,499
            -701,714,-588
            -643,-334,760
            -361,778,597
            -305,-533,-323
            -323,-424,-408
            432,-395,549
            -74,22,-27
            691,483,717
            -811,-331,748
            708,-667,-556
            -671,911,-585
            369,-410,442
            361,-388,472
            -606,763,-626
            -365,805,418
            710,576,541
            435,652,-571
            -385,-573,-325
            344,737,-649
            682,-849,-596
            739,-711,-666
            613,460,548

            --- scanner 18 ---
            630,-778,-377
            -642,806,-657
            404,849,-563
            -504,-789,-498
            -659,778,-635
            34,-62,148
            347,-484,785
            -420,405,665
            -457,478,604
            384,813,754
            -718,-667,757
            468,755,793
            263,852,-712
            -776,-678,695
            653,-822,-405
            476,-510,763
            -608,-880,-588
            256,827,-572
            278,-530,798
            -133,7,20
            -451,-884,-500
            -739,-633,765
            -391,622,660
            -640,591,-646
            281,729,780
            520,-823,-410

            --- scanner 19 ---
            -957,587,417
            711,-510,-899
            -500,835,-796
            348,583,-720
            778,798,343
            464,486,-727
            -414,-471,-425
            499,-891,534
            679,-608,-911
            -25,-50,-79
            723,847,380
            -872,565,330
            729,-629,-827
            -438,-453,-514
            -484,-382,-449
            -522,827,-826
            -507,764,-719
            -146,50,47
            -592,-511,505
            371,505,-551
            697,877,335
            -887,527,359
            -649,-548,577
            -460,-592,566
            748,-862,529
            624,-755,551

            --- scanner 20 ---
            -970,-446,-402
            660,-629,-380
            598,-630,-326
            -988,-361,-511
            417,-770,901
            601,432,-293
            -622,-623,933
            -592,-626,736
            -908,-363,-551
            -932,559,800
            592,518,-274
            -138,98,149
            -144,-53,-3
            -687,-664,785
            722,361,565
            626,329,-250
            -650,722,-312
            -522,661,-257
            356,-617,890
            -819,461,791
            531,-716,892
            671,-700,-274
            720,475,547
            742,448,520
            -928,380,827
            -482,710,-309

            --- scanner 21 ---
            -877,509,-750
            -613,-482,651
            442,-680,-742
            361,600,630
            -67,40,98
            -831,444,-821
            -901,420,-732
            841,456,-531
            -662,-606,635
            758,447,-603
            416,-669,822
            400,478,506
            419,-795,786
            362,461,559
            -617,367,784
            452,-827,847
            -666,-582,-655
            -515,413,801
            57,6,-81
            488,-602,-606
            -855,-571,-611
            -501,416,873
            -604,-546,456
            780,467,-571
            409,-665,-643
            -723,-510,-692

            --- scanner 22 ---
            -11,-95,-104
            -767,-537,-778
            -624,512,-512
            877,487,-759
            -686,495,624
            595,-590,329
            -607,370,-430
            -837,-531,-869
            609,-637,320
            -709,434,-421
            551,-611,-783
            602,-649,242
            695,527,-785
            -400,-664,553
            -883,498,594
            739,417,-816
            -517,-652,414
            -735,457,529
            688,-605,-694
            561,760,228
            -841,-389,-778
            -389,-727,337
            601,758,308
            671,-574,-878
            452,675,246

            --- scanner 23 ---
            843,466,-900
            825,-466,237
            -918,-519,-987
            823,-405,291
            835,504,-949
            833,-836,-616
            835,-457,249
            -59,-106,-149
            -710,351,663
            -729,-553,-963
            385,463,561
            549,340,563
            -815,-544,-944
            -503,691,-666
            -732,450,730
            -539,-683,472
            812,-735,-524
            803,-658,-667
            759,539,-965
            -546,-553,598
            -619,-530,502
            -657,662,-561
            -626,394,776
            440,517,552
            -550,724,-508

            --- scanner 24 ---
            -80,-88,-25
            -862,-445,-663
            803,-429,-392
            396,465,-685
            -847,-416,-625
            833,-844,438
            682,683,480
            -421,422,649
            -462,-802,883
            46,30,75
            -418,434,817
            -628,-861,890
            -366,483,777
            373,634,-607
            743,-774,505
            748,-466,-343
            -482,633,-426
            722,-421,-313
            718,764,371
            691,585,367
            -497,740,-363
            -475,710,-355
            761,-743,472
            -622,-705,862
            489,641,-704
            -932,-503,-603

            --- scanner 25 ---
            -711,-795,292
            820,713,-588
            682,725,-676
            780,291,672
            -448,-881,-583
            524,-765,493
            -489,-819,-650
            710,381,605
            494,-400,-461
            -423,-863,-611
            -828,406,739
            -796,-714,326
            -649,433,743
            -733,686,-909
            -866,-679,315
            -760,713,-931
            -847,668,-911
            -747,442,630
            425,-473,-488
            490,-786,522
            679,363,638
            601,-790,424
            573,-463,-414
            619,726,-626
            -3,-97,-140
    """.trimIndent()

val INPUT_2021_19_3 = """
            --- scanner 0 ---
            417,597,-659
            -781,-790,-526
            1,-140,-9
            311,816,519
            274,815,564
            -89,11,-167
            -842,-411,466
            -760,591,-661
            -831,-483,469
            -831,-515,455
            -826,643,-605
            -794,-873,-582
            378,-780,-402
            -864,635,-645
            369,-725,-496
            587,-558,577
            -973,480,540
            -723,-955,-453
            406,-622,-430
            510,768,-630
            -845,401,529
            492,744,-683
            618,-598,694
            -898,460,422
            630,-610,724
            313,739,706

            --- scanner 1 ---
            360,-299,497
            -508,-693,402
            -498,789,-433
            363,-337,520
            552,923,540
            760,712,-783
            -526,-582,503
            555,847,732
            -504,-552,465
            -44,110,-66
            -484,965,-483
            535,-532,-585
            -557,598,300
            804,671,-875
            -727,-524,-876
            -459,538,435
            -588,-537,-984
            496,-257,464
            529,794,525
            755,707,-914
            -547,549,368
            -628,-595,-809
            -368,847,-513
            683,-558,-467
            651,-545,-533

            --- scanner 2 ---
            -907,-631,538
            482,428,-727
            -880,-633,504
            735,570,659
            550,-692,-660
            -653,656,563
            10,-81,45
            634,-661,822
            660,694,698
            594,-647,753
            620,527,650
            -522,630,647
            415,439,-639
            -937,-647,-598
            -762,-705,-558
            562,-671,706
            -829,-634,-459
            -466,737,-818
            347,488,-629
            449,-803,-678
            -138,69,37
            -386,679,-688
            -436,855,-702
            -845,-568,655
            -499,588,611
            512,-662,-682

            --- scanner 3 ---
            726,450,702
            166,24,-152
            -805,-721,-823
            -566,541,485
            746,-764,-858
            829,-653,-923
            859,554,-478
            -683,591,521
            -797,-743,-752
            973,-907,634
            17,-64,-58
            -278,772,-974
            -377,-534,362
            893,-709,-835
            -709,-670,-777
            -410,724,-933
            651,280,750
            -381,771,-823
            769,484,-430
            676,558,-420
            909,-712,606
            930,-894,647
            666,355,677
            -339,-537,503
            -272,-423,393
            -606,549,396

            --- scanner 4 ---
            -577,625,351
            -79,-87,-12
            -382,653,287
            673,-570,651
            774,-493,620
            451,360,660
            579,759,-613
            424,-566,-782
            -535,-845,-759
            -580,-816,367
            -636,-904,431
            -611,806,-547
            -627,695,-442
            678,-402,614
            543,344,666
            426,-529,-611
            438,-545,-831
            -623,-779,-686
            392,339,534
            -395,666,330
            -525,-839,514
            600,756,-388
            672,782,-515
            -638,-814,-807
            -727,670,-545

            --- scanner 5 ---
            459,399,606
            379,533,690
            745,-584,-446
            772,-522,634
            -392,-600,-626
            -676,790,479
            -397,-421,763
            -31,66,-33
            -545,652,-604
            -539,-525,-602
            -656,865,597
            509,689,-635
            600,645,-566
            666,748,-599
            796,-438,630
            -368,-618,-573
            -321,-382,621
            -320,-419,576
            845,-644,-523
            368,475,733
            786,-593,-452
            76,-74,25
            -493,718,-548
            -735,737,586
            843,-594,685
            -116,-107,-99
            -501,756,-588

            --- scanner 6 ---
            -370,827,-693
            725,-460,-869
            433,-644,603
            569,-566,519
            -533,-499,398
            -491,-472,309
            611,789,-471
            783,797,397
            -381,855,-705
            735,662,382
            690,807,439
            -666,-597,-826
            -399,-453,375
            -349,800,-548
            -858,-599,-890
            599,925,-439
            -445,512,316
            380,-529,482
            684,-417,-838
            681,-402,-863
            -10,29,20
            730,884,-518
            -742,-531,-896
            -416,525,257
            -396,609,295

            --- scanner 7 ---
            -415,-962,703
            77,-97,178
            548,-679,932
            454,585,-397
            -397,-920,580
            735,468,512
            -519,-670,-454
            -760,489,755
            676,594,533
            -88,-171,102
            -655,712,-471
            -555,-735,-399
            449,548,-229
            -615,632,-371
            -824,435,717
            701,-677,-356
            689,-897,-372
            -725,560,673
            -680,-648,-345
            703,-848,-393
            -375,-851,645
            353,554,-320
            455,-581,955
            527,-454,929
            -645,642,-438
            584,600,517

            --- scanner 8 ---
            -54,-117,-72
            -854,705,692
            652,577,-579
            -757,-630,462
            496,-451,680
            -864,-693,499
            56,-81,110
            268,-484,696
            335,-405,615
            383,-649,-346
            -705,729,700
            -814,533,-677
            -881,643,-791
            470,-780,-408
            -530,-380,-563
            -823,-708,439
            657,398,697
            -776,674,-680
            -376,-432,-632
            619,664,-645
            687,604,684
            506,-633,-353
            476,642,-561
            689,444,705
            -412,-481,-505
            -729,735,762

            --- scanner 9 ---
            680,529,620
            -718,-621,-425
            -564,609,543
            411,533,-650
            31,103,28
            447,-502,547
            -680,-667,464
            -819,-601,-276
            -518,692,697
            -537,592,735
            -642,679,-491
            356,604,-585
            479,-689,-216
            544,607,704
            -667,754,-457
            -799,698,-515
            -84,-36,106
            419,-504,653
            468,-791,-343
            -731,-484,-303
            -669,-573,574
            424,-725,-247
            -749,-577,526
            477,-389,648
            733,644,741
            408,563,-430

            --- scanner 10 ---
            -485,824,-858
            703,502,-601
            -472,781,-845
            -634,-715,590
            462,-867,750
            -417,577,499
            -442,517,404
            -513,760,-663
            -369,502,329
            -723,-755,598
            599,-856,765
            305,404,532
            377,480,527
            -598,-832,640
            49,-126,70
            398,-890,-660
            -83,-28,-74
            297,-772,-602
            -616,-488,-488
            372,517,470
            -726,-421,-374
            -757,-526,-485
            608,585,-700
            605,-868,611
            349,-926,-533
            815,532,-667

            --- scanner 11 ---
            -694,427,-875
            562,-761,510
            537,656,390
            720,-789,482
            -399,545,639
            -520,580,654
            812,851,-392
            -651,-530,-656
            813,-609,-690
            -695,-546,-760
            -619,394,-717
            814,749,-523
            730,-665,-677
            -657,-532,521
            116,82,-5
            -447,514,742
            -828,-561,614
            895,-738,-619
            587,711,341
            866,801,-514
            -73,38,87
            -686,537,-712
            665,-695,473
            -703,-586,-722
            -804,-508,596
            552,738,329

            --- scanner 12 ---
            832,759,531
            -729,806,-799
            642,-813,-438
            -482,582,440
            485,577,-256
            -550,-716,536
            -628,-497,-361
            629,-747,-470
            -451,-793,599
            729,820,488
            -480,541,550
            -587,-405,-317
            574,493,-271
            535,-869,723
            -381,595,617
            -623,-366,-366
            616,-695,-586
            59,-35,-40
            -524,-761,551
            505,662,-299
            -102,90,32
            562,-857,688
            -810,700,-791
            -764,727,-839
            617,-808,738
            673,891,534

            --- scanner 13 ---
            -852,-535,-709
            465,732,427
            -868,-532,732
            -932,-337,760
            -142,-2,108
            -568,718,-463
            -33,60,-24
            -599,819,-386
            -605,723,-295
            313,-821,519
            -889,-350,773
            520,344,-381
            750,-574,-651
            526,399,-422
            340,662,457
            489,670,433
            -788,-591,-797
            418,-710,488
            -559,496,467
            603,384,-447
            -685,437,446
            846,-523,-697
            -553,588,451
            380,-707,629
            838,-501,-626
            -705,-480,-732

            --- scanner 14 ---
            -716,656,381
            -62,55,-107
            571,894,290
            -604,791,-506
            760,-301,297
            625,671,-651
            669,602,-742
            -776,-417,-727
            -881,781,374
            453,783,356
            -664,714,-406
            712,-342,429
            -682,-498,728
            546,-855,-657
            759,-452,400
            -665,-352,-810
            14,-63,26
            -755,-523,816
            492,844,281
            728,638,-585
            542,-797,-840
            -721,-440,-874
            -733,-452,824
            472,-845,-750
            -613,785,-465
            -735,824,404

            --- scanner 15 ---
            772,-816,337
            864,441,745
            -285,393,403
            -507,-507,398
            737,-752,429
            867,424,805
            -372,-522,350
            -270,823,-443
            908,466,819
            -598,-547,-666
            -558,-636,-674
            668,-751,287
            -402,782,-491
            -675,-672,-624
            674,-828,-860
            734,-853,-765
            867,327,-661
            -244,314,534
            -362,-564,443
            -380,346,522
            -373,672,-444
            684,269,-657
            118,-82,2
            659,-901,-935
            777,279,-731

            --- scanner 16 ---
            665,708,-330
            -733,694,571
            664,-786,320
            -808,582,463
            630,787,-370
            -646,651,424
            488,-424,-852
            -728,-766,-699
            606,-866,450
            529,-516,-808
            524,-385,-803
            -715,-714,-583
            327,398,388
            711,681,-378
            -183,-72,54
            -584,558,-913
            -604,643,-870
            782,-816,436
            -741,-832,-731
            446,529,388
            -707,-423,679
            -720,-315,540
            -778,-490,580
            474,346,310
            -25,68,-28
            -673,474,-898

            --- scanner 17 ---
            462,-358,694
            852,846,-508
            -749,-272,-739
            119,111,14
            506,-450,653
            784,661,-492
            831,-340,-724
            -696,-348,-640
            984,774,517
            -454,-746,830
            944,853,552
            -295,629,799
            -257,397,-736
            -708,-487,-709
            -405,588,801
            803,-303,-697
            8,22,117
            -472,642,900
            -391,-669,731
            511,-319,658
            -406,-714,757
            939,-393,-705
            -455,474,-726
            936,747,471
            -316,509,-721
            722,783,-535

            --- scanner 18 ---
            746,-835,-745
            500,476,-649
            -537,-859,-713
            -813,650,483
            -874,568,498
            590,-348,604
            512,492,-429
            -653,-723,-715
            -798,-418,622
            -721,-517,685
            577,-449,781
            886,706,687
            498,513,-478
            536,-447,671
            674,-809,-872
            71,46,-110
            754,865,690
            -461,792,-501
            -40,119,53
            653,-812,-647
            -549,726,-574
            -766,-491,670
            -862,595,533
            -553,-748,-818
            815,762,733
            -74,-66,-38
            -564,761,-453

            --- scanner 19 ---
            -582,281,-494
            -843,-640,442
            -757,506,680
            -626,-395,-625
            -515,369,-529
            -548,-398,-675
            -829,493,530
            818,495,-500
            -620,372,-650
            -552,-517,-656
            109,4,-110
            847,762,352
            829,-608,-764
            -602,-680,432
            -782,525,623
            880,784,550
            814,778,584
            832,585,-685
            -713,-658,372
            352,-672,455
            869,449,-593
            391,-716,632
            845,-529,-874
            20,-172,26
            445,-695,591
            842,-470,-752

            --- scanner 20 ---
            -557,-265,-548
            -731,788,725
            -688,-578,559
            -874,793,658
            -723,-563,438
            -60,-7,111
            754,953,782
            -530,-253,-513
            419,831,-624
            555,-406,-700
            -754,-666,486
            54,128,35
            578,846,-672
            -612,-314,-498
            -519,599,-775
            -841,951,733
            897,-590,698
            761,-474,700
            529,-361,-685
            814,910,898
            786,-574,803
            709,817,838
            -467,590,-827
            -417,468,-773
            593,832,-733
            456,-329,-637

            --- scanner 21 ---
            349,652,447
            -529,349,581
            467,-913,584
            365,744,495
            -528,338,595
            -439,-716,-675
            378,-849,647
            -916,835,-971
            796,-844,-856
            674,781,-874
            -482,-748,749
            -500,-654,775
            -422,-583,-735
            -527,-680,564
            441,-906,641
            333,680,656
            -133,46,-68
            -419,-571,-613
            33,-85,-36
            720,786,-873
            -821,808,-908
            834,-717,-970
            -493,393,568
            819,-796,-856
            -864,798,-814
            651,871,-730

            --- scanner 22 ---
            -751,763,-725
            -630,-391,-700
            451,501,-562
            745,-844,401
            -680,822,-674
            -339,676,443
            -322,683,330
            761,-624,389
            511,-699,-660
            -391,-851,432
            724,-795,387
            -309,-637,433
            386,418,-673
            888,601,641
            476,-820,-675
            -601,-562,-793
            474,354,-617
            -50,36,-34
            -757,722,-734
            -371,661,286
            -358,-658,392
            -63,-134,-164
            797,607,737
            445,-772,-572
            -577,-415,-718
            720,638,636

            --- scanner 23 ---
            405,660,729
            105,150,11
            697,920,-522
            -808,840,-493
            444,704,552
            -776,-505,654
            -685,725,-506
            -704,-518,504
            383,-758,-834
            -790,628,742
            498,683,593
            933,-796,634
            -790,-305,-515
            415,-625,-778
            -660,646,812
            -549,668,752
            -801,-394,-474
            867,-790,600
            -729,-537,561
            701,700,-502
            -765,815,-497
            466,-777,-839
            730,759,-607
            -17,-25,40
            -819,-485,-561
            900,-774,832

            --- scanner 24 ---
            -885,-456,811
            492,775,662
            -788,-411,925
            488,894,681
            783,652,-436
            -905,763,880
            349,-596,421
            -708,-433,751
            -79,52,127
            -1,-85,-13
            -505,597,-585
            503,-466,-712
            -855,-746,-414
            542,612,-426
            430,-460,-618
            -889,684,770
            -909,-684,-257
            374,-605,-707
            -412,620,-449
            -969,-707,-470
            -451,576,-626
            446,-598,394
            653,634,-366
            289,-511,382
            -902,822,758
            566,897,631

            --- scanner 25 ---
            697,-510,490
            755,-515,605
            -440,481,441
            -430,-776,-600
            706,481,892
            766,568,-462
            727,-409,603
            -339,-379,543
            695,354,790
            47,-53,139
            -508,526,626
            -338,-710,-619
            818,723,-503
            84,121,36
            -275,-468,606
            763,788,-432
            750,385,826
            -472,-687,-573
            494,-482,-428
            -282,-442,549
            -578,732,-719
            -534,499,415
            -616,670,-761
            441,-603,-543
            630,-566,-506
            -638,732,-698

            --- scanner 26 ---
            -714,-918,-562
            369,-722,-477
            487,609,527
            -598,706,-362
            -484,-631,683
            -648,-919,-708
            -395,-687,653
            -412,443,517
            439,-712,-444
            -592,761,-321
            -716,-830,-642
            592,-827,749
            481,517,511
            74,2,8
            -33,-144,105
            -537,373,487
            496,387,-403
            -597,-685,736
            -561,435,493
            646,-891,711
            613,668,506
            533,382,-235
            -675,721,-387
            527,286,-326
            449,-682,-377
            521,-792,667

            --- scanner 27 ---
            391,-557,-718
            563,311,-710
            -457,-686,560
            -503,-840,643
            -402,788,-820
            -633,-671,-532
            -476,-648,660
            -450,747,-688
            741,-763,723
            794,-642,608
            -625,-582,-492
            490,678,496
            439,-542,-583
            -583,-707,-415
            -498,398,402
            444,358,-805
            449,709,539
            605,-679,645
            -403,637,-717
            484,-599,-728
            575,279,-846
            13,-166,107
            -390,373,471
            493,703,481
            -512,399,370
            68,-45,-73

            --- scanner 28 ---
            582,501,-693
            -293,833,-689
            -454,-545,388
            796,693,822
            -330,648,793
            549,-924,909
            -557,-416,-719
            -250,846,-676
            -6,-10,-31
            -314,651,-648
            723,605,756
            479,601,-718
            -477,703,816
            -547,-619,378
            844,590,791
            584,617,-829
            624,-766,942
            -364,-615,436
            444,-790,-641
            500,-926,-686
            160,-65,70
            -394,592,881
            557,-761,799
            -572,-341,-792
            384,-883,-746
            -497,-511,-744

            --- scanner 29 ---
            382,-681,475
            -351,-434,-559
            -402,720,-764
            -478,-332,-570
            800,822,480
            471,-618,411
            -477,800,-630
            513,-734,-561
            -496,-809,670
            -382,-398,-614
            445,-675,418
            823,822,528
            -478,-783,576
            -418,701,741
            518,-619,-619
            838,936,607
            40,-33,4
            -9,72,165
            473,806,-344
            -435,641,608
            386,752,-237
            -523,-598,644
            509,763,-398
            412,-621,-591
            -454,816,-689
            -415,579,753

            --- scanner 30 ---
            -4,-8,-83
            -622,-534,377
            -443,897,-643
            -508,379,661
            -450,480,779
            673,-712,-556
            576,694,-553
            88,126,45
            747,-706,337
            554,692,327
            495,659,-574
            581,-696,-562
            -577,431,815
            522,-717,-688
            -410,690,-696
            -625,-675,415
            -252,-403,-935
            755,-730,486
            517,629,434
            -736,-644,310
            -265,-390,-892
            494,707,368
            -447,-431,-871
            499,509,-547
            817,-736,462
            -509,785,-613

            --- scanner 31 ---
            367,-348,-854
            254,-264,598
            357,532,-577
            492,-355,-689
            477,677,652
            -695,818,406
            -779,898,540
            546,768,696
            -665,-383,493
            -822,909,482
            -140,33,-111
            304,-255,519
            -719,481,-431
            363,491,-586
            -723,505,-515
            -774,434,-587
            324,-378,-708
            -895,-681,-373
            -726,-433,361
            510,611,755
            -851,-734,-482
            -91,143,54
            365,-330,480
            434,432,-637
            -660,-538,430
            -844,-571,-368

            --- scanner 32 ---
            -662,500,-315
            -837,-866,578
            -81,29,87
            -652,-880,668
            398,-956,638
            -585,-890,-387
            601,-549,-847
            -573,-877,-525
            281,732,878
            -687,572,455
            345,496,-692
            -712,578,-312
            403,-813,705
            -681,504,-434
            359,511,-753
            -843,534,364
            -463,-893,-446
            -808,467,452
            723,-499,-793
            592,-601,-795
            360,337,-644
            -744,-917,532
            21,-144,-39
            238,672,762
            374,627,818
            240,-923,713

            --- scanner 33 ---
            -77,29,-55
            -442,-597,702
            427,-632,-886
            -538,-460,-459
            -348,463,460
            627,-772,760
            -551,-423,701
            822,374,525
            -503,-582,716
            -677,608,-444
            -627,553,-395
            -475,-559,-536
            630,-848,568
            819,412,548
            647,607,-557
            -402,413,338
            686,332,492
            653,-719,553
            -662,526,-383
            422,-637,-755
            29,-89,-133
            -400,515,469
            531,620,-505
            378,-596,-847
            499,633,-439
            -490,-533,-491

            --- scanner 34 ---
            458,-419,-582
            -293,-415,514
            -260,913,598
            154,126,94
            -488,-625,-457
            509,544,-583
            55,-19,-30
            576,643,-654
            -312,835,451
            431,-453,-580
            902,787,906
            -424,-703,-396
            816,-562,681
            -443,835,570
            -308,-268,484
            401,683,-596
            -565,799,-522
            -575,-728,-478
            -496,760,-684
            839,-526,639
            952,773,730
            -400,-335,494
            685,-478,707
            872,903,788
            493,-570,-517
            -608,652,-609

            --- scanner 35 ---
            587,-669,-516
            512,-575,482
            -393,-672,-483
            547,657,-893
            662,536,-840
            493,-599,639
            599,651,377
            -57,-48,-110
            628,-514,-568
            584,620,-704
            -476,592,484
            -789,700,-583
            -644,757,-538
            658,-734,-571
            -779,742,-490
            -440,-611,513
            582,459,404
            499,613,358
            -472,-714,-522
            -593,628,534
            -553,717,526
            -452,-605,359
            -441,-468,374
            437,-541,507
            -440,-828,-567
    """.trimIndent()

operator fun Point3D.plus(other: Point3D) = Point3D(x + other.x, y + other.y, z + other.z)

operator fun Point3D.minus(other: Point3D) = Point3D(x - other.x, y - other.y, z - other.z)

fun Point3D.up(up: Int) = when (up) {
    0 -> this
    1 -> Point3D(x, -y, -z)
    2 -> Point3D(x, -z, y)
    3 -> Point3D(-y, -z, x)
    4 -> Point3D(-x, -z, -y)
    5 -> Point3D(y, -z, -x)
    else -> throw IllegalArgumentException()
}

fun Point3D.rot(rot: Int) = when (rot) {
    0 -> this
    1 -> Point3D(-y, x, z)
    2 -> Point3D(-x, -y, z)
    3 -> Point3D(y, -x, z)
    else -> throw IllegalArgumentException()
}

private class ScannerOrientation(scanner: Scanner) {

    val variations: Array<Scanner> = Array(24) { position ->
        Scanner(scanner, position / 4, position % 4)
    }

    operator fun get(up: Int, rot: Int) = variations[rot + up * 4]
}

data class Scanner(val beacons: MutableList<Point3D> = mutableListOf()) {

    constructor(other: Scanner) : this(other.beacons.toMutableList())

    constructor(other: Scanner, up: Int, rot: Int) : this(mutableListOf<Point3D>().apply {
        for (beacon in other.beacons) {
            this += beacon.up(up).rot(rot)
        }
    })
}

private fun Scanner.test(other: Scanner): Point3D? {
    for (i in beacons.indices) {
        for (j in other.beacons.indices) {
            val bi = beacons[i]
            val bj = other.beacons[j]
            val relPoint = bj - bi
            var count = 0
            for (k in beacons.indices) {
                if (count + beacons.size - k < 12) break
                for (l in other.beacons.indices) {
                    val bk = beacons[k]
                    val bl = other.beacons[l]
                    if (relPoint + bk == bl) {
                        if (++count >= 12) return relPoint
                        break
                    }
                }
            }
        }
    }
    return null
}

private fun Scanner.match(other: ScannerOrientation): Pair<Scanner, Point3D>? {
    for (scanner in other.variations) {
        val matched = test(scanner)
        if (matched != null) return Pair(scanner, matched)
    }
    return null
}

private fun orientations(input: String): List<ScannerOrientation> {
    val scanners = mutableListOf<Scanner>()
    for (line in input.split("\n").filter { it.isNotBlank() }) {
        if (line.startsWith("---")) {
            scanners += Scanner()
        } else {
            val (x, y, z) = line.split(",").map { it.toInt() }
            scanners.last().beacons += Point3D(x, y, z)
        }
    }
    return scanners.map { ScannerOrientation(it) }.toList()
}

fun findPositions(input: String): Pair<List<Point3D>, List<Scanner>> {
    val orientations = orientations(input)
    val scanners = arrayOfNulls<Scanner>(orientations.size)
    val positions = arrayOfNulls<Point3D>(orientations.size)
    scanners[0] = orientations[0][0, 0]
    positions[0] = Point3D(0, 0, 0)
    val frontier = ArrayDeque<Int>()
    frontier += 0
    while (!frontier.isEmpty()) {
        val front = frontier.poll()
        for (i in orientations.indices) {
            if (positions[i] == null) {
                scanners[front]!!.match(orientations[i])?.let { (scanner, point) ->
                    scanners[i] = scanner
                    positions[i] = positions[front]!! + point
                    frontier += i
                }
            }
        }
    }
    return positions.filterNotNull() to scanners.filterNotNull()
}
