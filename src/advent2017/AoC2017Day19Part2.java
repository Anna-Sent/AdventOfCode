package advent2017;

public class AoC2017Day19Part2 {
    public static void main(String[] args) {
        int result;

        result = test("" +
                "     |          \n" +
                "     |  +--+    \n" +
                "     A  |  C    \n" +
                " F---|----E|--+ \n" +
                "     |  |  |  D \n" +
                "     +B-+  +--+ \n");
        System.out.println(result);
        assert result == 38 : "unexpected result is " + result;

        result = test("" +
                " |                                                                                                                                                                                                       \n" +
                " |                                   +---------------------------------------------------------------------------------------------------------------------------------------------------------------+   \n" +
                " |                                   |                                                                                                                                                               |   \n" +
                " |     +-------------------------------------------+                                                   +-------------+   +---------------+                     +-------------------------------------+   \n" +
                " |     |                             |             |                                                   |             |   |               |                     |                                         \n" +
                " |     +-----------------------------|---------+   |   +-+ +-------+                       +---+       |             |   |   +-----------|-----------------------------------------+   +-----------+     \n" +
                " |                                   |         |   |   | | |       |                       |   |       |             |   |   |           |                     |                   |   |           |     \n" +
                " |                                   |         +---|---|---|-------------------------------|---|-------|-------------|---|---------------|---------------------------------------------+           |     \n" +
                " |                                   |             |   | | |       |                       |   |       |             |   |   |           |                     |                   |               |     \n" +
                " |       +-----------------+         |         +---------|--------------------------B----------+       +-------------|---|---|-----------|---------------------|---------------+   | +---+     +-+ |     \n" +
                " |       |                 |         |         |   |   | | |       |                       |                         |   |   |           |                     |               |   | |   |     | | |     \n" +
                " |       |                 |         |         |   |   +-|---------|-------+               |           +---------------------------------------+               |               |   +-|---|-------+ |     \n" +
                " |       |                 |         |         |   |     | |       |       |               |           |             |   |   |           |     |               |               |     |   |     |   |     \n" +
                " |       |                 |         |         +---------|-|---------------|---------+     |     +-----|-------+     |   |   |           |     |               |               |     |   |     |   |     \n" +
                " |       |                 |         |             |     | |       |       |         |     |     |     |       |     |   |   |           |     |               |               |     |   |     |   |     \n" +
                " |       |                 +---------|-------------|-----|-|-------+       |         +-----|-----|-------------------+   | +-------------------+               |   +---------------------|-----|-------+ \n" +
                " |       |                           |             |     | |               |               |     |     |       |         | | |           |                     |   |           |     |   |     |   |   | \n" +
                " |       +---------------------------------------+ |   +-|-+               |               |     |     |     +-+ +-------|-|-|-+         |                     |   |           |     |   |     | +-+   | \n" +
                " |                                   |           | |   | |                 |               |     |     |     |   |       | | | |         |                     |   |           |     |   |     | |     | \n" +
                " |                                   |         +-|-----|-|-+               |     +---------|-----|-----------|---|---+ +-|-|-----+     +-|-+                   +---------+     +-------+ |     | |     | \n" +
                " |                                   |         | | |   | | |               |     |         |     |     |     |   |   | | | | | | |     | | |                       |     |           | | |     | |     | \n" +
                " |                                   |         | | |   | | |           +---|-----|---------|-----|-----|---------|---|-|-|-|---|-|-----|-|-|-----------------------------|-------+   | | | +---+ |     | \n" +
                " |                                   |         | | |   | | |           |   |     |         |     |     |     |   |   | | | | | | |     | | |                       |     |       |   | | | |     |     | \n" +
                " | +---------------------------------|---------|---|---|-|-------------|-------------------|-----------+     +---------|-|-+ | | +-+   | | +-------------+         |     |       |   | | | |     |     | \n" +
                " | |                                 |         | | |   | | |           |   |     |         |     |               |   | | |   | |   |   | |               |         |     |       |   | | | |     |     | \n" +
                " | | +-+ +-+                         |         | | |   | | |         +-----------|-----+   |     |   +-----------|---+ | |   | +---|-+ | |               |         |     |       |   | | | |     |     | \n" +
                " | | | | | |                         |         | | |   | | |         | |   |     |     |   |     |   |           |     | |   |     | | | |               |         |     |       |   | | | |     |     | \n" +
                " | | | | | +-------------------------|---------|-|-----|---|---------------|-----|---------|-----|---------------|-------|-------------|---+             |         |     |   +---|---|-|-|-------|-+   | \n" +
                " | | | | |                           |         | | |   | | |         | |   |     |     |   |     |   |           |     | |   |     | | | | |             |         |     |   |   |   | | | |     | |   | \n" +
                " | | | +---+         +-------------------------------+ +-|-+         | |   |     |     |   |     |   |           |     | |   +-----+ | | | |             |         |     |   |   |   | | | |     | |   | \n" +
                " | | |   | |         |               |         | | | |   |           | |   |     |     |   |     |   |           |     | |           | | | |             |         |     |   |   |   | | | |     | |   | \n" +
                " | | |   | |         |               |     +---|---|-----------------|-----------|-------------------|-----------------|-------------|-----------------------------|-----------------|---|-|-+   | |   | \n" +
                " | | |   | |         |               |     |   | | | |   |           | |   |     |     |   |     |   |           |     | |           | | | |             |         |     |   |   |   | | | | |   | |   | \n" +
                " | | |   | |       +-+ +-------------|---------|-|---|-------+       | |   |     |     |   |   +-----|-----------------------------------|-|-+   +-------|---------|-----|---|---------+ | +-----+ |   | \n" +
                " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |     |   |   | |   |           |     | |           | | | | |   |       |         |     |   |   |   |   |   |     |   | \n" +
                " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |     +---------|---|-----+     |     +-|-------------|-----+   |       |         |     |   |   |   |   |   |     |   | \n" +
                " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |         |   | |   |     |     |       |           | | | |     |       |         |     |   |   |   |   |   |     |   | \n" +
                " +---------------------------------------------|---|-|-+ |   |       | |   |     |     +-------------+     |     |       |     +-----|-|-|-------|-------|---------------|---|-------------+ |     |   | \n" +
                "   | |   | |       |   |             |     |   | | | | | |   |       | |   |     |     |   |   | |         |     |       |     |     | | | |     |       |         |     |   |   |   |   | | |     |   | \n" +
                "   | |   | | +---------------+     +-------|---|-|-+ | | |   |     +---|---|-----|-----|---|---|-------------------------------|---------|-|-----|-+     |         |     |   |   |   |   | | |     |   | \n" +
                "   | |   | | |     |   |     |     | |     |   | |   | | |   |     | | |   |     |     |   |   | |         |     |       |     |     | | | |     | |     |         |     |   |   |   |   | | |     |   | \n" +
                "   | |   | | |     |   |     |   +-|-------|-----|-----------|-------|-|---|-------------------|-|---------|-----|-------|-----------|-|-|-|-----------------------|-----|---+   |   |   | | | +-----+ | \n" +
                "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |     |   |   | |         |     |       |     |     | | | |     | |     |         |     |       |   |   | | | |   | | | \n" +
                "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |   +-+   |   +-|---+     |     | +-------+   |     | | | |     | |     |         |     |       |   |   | | | |   +---+ \n" +
                "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |   |     |     |   |     |     | |     | |   |     | | | |     | |     |         |     |       |   |   | | | |     |   \n" +
                "   | |   | +-|---------------------|-------|-+ | |   | | | +-------|-|-------------------------+ |   +-----|---------------------+ +---+ +-------|-----+ |   +-----|-------------|---------|-|---+ +---+ \n" +
                "   | |   |   |     |   |     |   | | |     | | | |   | | | | |     | | |   |     |   |     |   | |         |     | |     | |   | | | |     |     | |   | |   |     |     |       |   |   | | | | | | | | \n" +
                "   | |   |   |     |   |     |   | | |     | | | |   +-|-----|-------|-----+     |   |     |   | +---------------|-|-----------|---+ +-----|-----+ +---|-------------------------|---|---|-|-|-|---+ | | \n" +
                "   | |   |   |     |   |     |   | | |     | | | |     | | | |     | | |         |   |     |   |           |     | |     | |   | |         |           | |   |     |     |       |   |   | | | | |   | | \n" +
                "   | |   |   |     |   |     |   | | |     | | | |     | | | |     +-----------------|-----|---|-----------|-------|-----|---+ | +-+       |           | |   |     |     |       |   |   | | | | | +-|-+ \n" +
                "   | |   |   |     |   |     |   | | |     | | | |     | | | |       | |         |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   |   | | | | | | |   \n" +
                "   | |   |   |     |   |     |   | | |     | | +---+   | | | |     +---------------------------------------|-----|-|-------|---|-----------------------|-|---|-------------------|-----------|-+ | +---+ \n" +
                "   | |   |   |     |   |     |   | | |     | |   | |   | | | |     | | |         |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   |   | | |   |   | | \n" +
                "   | |   |   |     +-+ |     |   | | |     | |   | | +---|-|-+     | | |     +-------|---------|-----------------|-------------|-----------|-----------|-----------|-----|-----------|-+ | | |   |   | | \n" +
                "   | |   |   |       | |     |   | | |     | |   | | | | | |       | | |     |   |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   | | | | |   |   | | \n" +
                "   | |   |   | +-------|---------|---|-----|-----|-|-|---|-----------|-------|-------------+   |     +-----|-------|-+   | | | |   |       |           | |   |     |     |   +---|---|-|-|-|-|---------+ \n" +
                "   | |   |   | |     | |     |   | | |     | |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |   |       |           | |   |     |     |   |   |   | | | | |   |   |   \n" +
                "   | |   |   | |     | |     |   +---------|-|-----|---------------|-|-------|---|-------------------------|-----|-|-|---|---|-------------|-------------|-----+   |     |   |   |   | | | | |   |   |   \n" +
                "   | |   |   | |     | |     |     | |     | |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |   |       |           | |   | |   |     |   |   |   | | | | |   |   |   \n" +
                "   | |   |   | +-------------|-----|-|-----+ |   | | | | | |       | | |     |   |   |         |     |     |     | | +-----|-|-|---+       |           | |   | |   |     +---|---|---|-----+ | +-+   |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | |     | | | |           |           | |   | |   |         |   |   | | |   | |     |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | | +-------|-|-----------|-------------|---|-|-----------------------|---+ | |     |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |           |           | |   | |   |         |   |   | | | | | |     |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |     +---|-----|-----|-----|-|-----|---|-------------|-----------|-|---|-|-------------|-+ |   | | | | | |     |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |     |   |     |     |     | | |   | | | |           |           | |   | |   |         | | |   | | | | | |     |   \n" +
                "   | |   |   | +-----|-------------------------------|---|-|-----------------|---|---|---------|-----|-----|-----|-|-|-----|-|-|-------------+         | |   | |   |       +-|-|-|---|---|-|-------+ |   \n" +
                "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   |   |     |   |     |     |     | | |   | | | |           | |         | |   | |   |       | | | |   | | | | | |   | |   \n" +
                "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | +-|---------------|-----|---------|-----|-|-|-------------|---------|U|---------------+ | | | |   | | | | | |   | |   \n" +
                "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | | |     |   |     |     |     | | |   | | | |           | |         | |   | |   |     | | | | |   | | | | | |   | |   \n" +
                "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | +-+     |   |     |     |     | | |   +-|---|-------------|-+       | | +---|---------|-|-----|-+ | | | | | |   | |   \n" +
                "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |     |     | | |     | | |           | | |       | | | | |   |     | | | | | | | | | | | |   | |   \n" +
                "   | |   |   | +-----|-------|-----|-------------|---|---|-|-----------|-----------------------|-----|---------------------|-|-------------|-----------|-|-+ | |   |     | | | | | | | | | +-----+ | |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |     |     | | |     | | |           | | |       | |   | |   |     | | | | | | | | |   | | | | |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |   +-|-----|---------|-|---------------|-|---------------|---|-----+ | | | | | | | |   | | | | |   \n" +
                "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |   | |     | | |     | | |           | | |       | |   | |   |       | | | | | | | |   | | | | |   \n" +
                "   | | +---------+   | |     |     | | +-----|-------+ | | |       | +-----------------------------------|-|---------------+ | |       +---|-|-+     +-+ |   | |   +-------|-|-|-|---|-|-|-+ | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | |       |   |   | |           | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | +-----+   |   | |     +---+ | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         +-------+ |   | |     | | |     +-|-|-------|-----|-|---------|-----------|-+ | | | | | | | | | | | | | | |   \n" +
                "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |             |   | |   | |     | | |     | | |       |   | | |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
                "   | | +-----|---|---|-|-----|-----|-----------------------------------|-----|-----------------|---------|-------|---------|-----+   +-------+ |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
                "   | |   |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |             |   | |   | |     | | |     | | | |   | |   |   |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
                "   | |   |   |   |   | +-------------|-|-----|-----|---|-|-|---+   |   |   +-|-----------------------|---|-|---------|-----|---|-|---|---------|-------------|---------|-+ | | +-----|-----|---|---|---+ \n" +
                "   | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | |   | |   |   |         |   | |     | |   | |   | | | | | | | | | | | | \n" +
                " +-|-----|-------|---------------------|-----|---|-|---|-------|-----------|-|---------------------|-|-----|-----|-|-|-----|-|-|-----|-----|---|-------+ |   | +-----|-|-----|---|---|---|-|---|---+ | | \n" +
                " | | |   |   |   |   |       |     | O |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | |   | |   |   |       | |   |       | |   | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | +---|-----|-S |       | |   |       | +-+ | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | |     | |   |   |       | |   |       |   | | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             +---|-|---|-|---------------|-|-|-------|---+ +-|-------|-----|-------|---+ | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | |     | |       | |   |       |     | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   +-------|---|---|-------|-------|-----------------------|-|-------------------------|---------+   | |       | |   |       | +-+ | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   | +-----|-------|-------|-----+ | |   |               +-|-|-----|-----|---|---+ | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
                " | | |   |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |     | | |   | | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
                " | | | +-|---|---|-----------|-------|-----|-----|-|---------------|-----|-|-|-------------------|-|-|---------+ | | |   | | | |     | | |   | +-------------|-+     | | | | |   | +---+ | | | | |   | | \n" +
                " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |     | | | | |   |   |   | | | | |   | | \n" +
                " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |     +---|---|-+ |   |   | | | | |   | | \n" +
                " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |       | | | | | |   |   | | | | |   | | \n" +
                " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | +-----------|-+ |         | |   | |     +---|---+ | |   |   | | | | |   | | \n" +
                " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | |   |     | | | | |         | |   | |     | | | |   | |   |   | | | | |   | | \n" +
                " | | | | |   |   | +-|---------------|-|-----------|-----|-----|---|-----|-------|-------------+ | +-------|-+ | | | |   | |   |     | | | | | +---------|---|-----------|-----|---------|---|-------|-+ \n" +
                " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | +-|-|-+     | |   | |     | | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | |   | | |     | |   | |     | | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |   +-|-|-------|-----|---|---------|-|-----------+   |   | | | |   |             | |   +---|---|-|-|-|-------|---------|---|---|-+ +-+   | +---|-------+ | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |     | |       |     | | |   |     | |   | | |       |   | | | |   |             | |       | | | | | | |   | |   |     | | |   |     |   |     | |       | | |   | |   |   | | | | |   |   \n" +
                " | | | | |   |     | | +-------------------|-------|-------|-----------|---|-|-----------------|-----------|-------|-----|-+   +-------|-|---|-------------------------|---|-------------|-|---------|-+ \n" +
                " | | | | |   |     | | |     |     | | |   |     | |   | | |       |   | | | |   |             | |       | | | | | | |   |           | | |   |     |   |     | |       | | |   | |   |   | | | | |   | | \n" +
                " | | | | | +---------------------------|---|-----|-----------------|---|-|-|-|---|-------------|-|---------|-+ | | | |   |           | | | +-|-----|-----------|-------|---|-----|---|-+ | | | | |   | | \n" +
                " | | | | | | |     | | |     |     | | |   |     | |   | | |       |   | | | |   |             | |       | |   | | | |   |           | | | | |     |   |     | |       | | |   | |   | | | | | | |   | | \n" +
                " | | +---|---------------------------|-------------|-------------------|-|-|-|---------+ +-----|-----------|-----|-|-|---|-------------|-|-------+ |   |     | |       | | |   | +-----------+ | |   | | \n" +
                " | |   | | | |     | | |     |     | | |   |     | |   | | |       |   | | | |   |     | |     | |       | |   | | | |   |           | | | | |   | |   |     | |       | | |   |     | | | |   | |   | | \n" +
                " | |   | | | |     | | +-----|-----|---|---|---+ | |   | | |   +-------|-----|-----------|---------------|-------|---|-------------------|-+ |   | |   |     | |       | | | +-|-----|---|-|---|-|-+ | | \n" +
                " | |   | | | |     | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |       | |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | |   | | | | | \n" +
                " | |   | | +-+     | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |       +-------|-|-|---|-----------|---|---|---|-----|-----|-|---------|-----------|-|-|-|-+ | | | | | \n" +
                " | |   | |         | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
                " | | +---|---------|---+     |     | | |   |   | | |   | | |   | +-----|-|-+ |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |   | |   |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |   +---------|-----|-|-----------------|-------|-------------------|-|---|---|-|---|-------+       | | | | |     +-|---|-+ | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   | +-----|-----------------|---|-|---|---|---------+ | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   | |   | |     | |         |   | | | |   |         | | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     +-------+ |   | |     | |         |   | | | |   |       +-|-|-------+ +-------------|---+     | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | | | |     | | |   |     |   |     | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | | +-------+ | |   |     |   |     | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | |   |       | |   |     |   |     | C | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   | +---------------------|-|-----|-|-----------------|-----|-------------+ |       | |   |     |   |     | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | |   | | | | | \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | | +-|-----|-+ \n" +
                " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
                " | | | | |         | | |     |     | | |   |   | +-----|-+ |   +-------------|-----------|-----------------+   | +-|-|---|-----------+ | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
                " | | | | |         | | |     |     | | |   |   |   |   |   |       |         |     |   | |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
                " | | | | |         | | |     |     | | |   |   |   +---|---|-------|---------------|---+ |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
                " | | | | |         | | |     |     | | |   |   |       |   |       |         |     |     |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
                " | | | | |         | | |     |     +-|-|---|---|-------|---|-------|-----+   |     |     +---+ | |         +---|---------|---------------------+ | |   |     |   |     | | | | | +-------|-|---|-|-|-|-+ \n" +
                " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
                " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
                " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
                " | +-+ | |         | | |     |       | |   | +-+       |   |       |     |   |     |         | | +---------|-------|-|-----------|-|-----------|---|---|-----|---|-----+ +---|---------|-------|-----|-+ \n" +
                " |     | |         | | |     |       | |   | |         |   |       |     |   |     |         | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
                " |   +-------------|-|-------|-------------|-|-+   +---|---|-------|-----|---------|---+     | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
                " |   | | |         | | |     |       | |   | | |   |   |   |       |     |   |     |   |     | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
                " |   | | |       +-|---|---------------|-------|-------|-----------------|---|-----+   |     | |     +---------|---------|-------------|-------|---------------+ |     +-+ | | | |     | | | | | | | |   \n" +
                " |   | | |       | | | |     |       | |   | | |   |   |   |       |     |   |         |     | |     |     |   |   | |   |       | |   | |     | | |   |     | | |     | | | | | |     | | | | | | | |   \n" +
                " |   +-|---------|---+ |     |       | |   | | |   |   |   |       |     |   |         |   +---------|---------------------------|-----|---------------|---------------------|-|-|---+ | | +-+ | | | |   \n" +
                " |     | |       | |   |     |       | |   | | |   |   |   |       |     |   |         |   | | |     |     |   |   | |   |       | |   | |     | | |   |     | | |     | | | | | |   | | |     | | | |   \n" +
                " |     | |       | |   |     |       | |   | | |   |   | +-|-------------|-----------------|-|-------------|-+ |   | |   |       | +-----|-------|-----|-----|-|-------|-----|-|-------+ |     | | | |   \n" +
                " |     | |       | |   |     |       | |   | | |   |   | | |       |     |   |         |   | | |     |     | | |   | |   |       |     | |     | | |   |     | | |     | | | | | |   |   |     | | | |   \n" +
                " |     | |       | |   |     |     +-|-----|-|-----|-------------------+ |   |         | +-+ | |     |     | | |   | |   |       +-----+ |     | | |   |     | | |     +---|---|-|---|-+ |     | | | |   \n" +
                " |     | |       | |   |     |     | | |   | | |   |   | | |       |   | |   |         | |   | |     |     | | |   | |   |               |     | | |   |     | | |       | | | | |   | | |     | | | |   \n" +
                " +-----------------|---+     +-----+ | |   | | |   +---|---|-----------|-|---------------|-----|-----|-------------|-|-------------------+     | | |   |     | | |       | | | +-|---|-+ | +-+ | | | |   \n" +
                "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |   |   | | | | | | |   \n" +
                "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |   +-------|-----|---+ \n" +
                "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |       | | | | | | | | \n" +
                "     +-|-------------------------------|-------|---------|-------------|-|---|-----------+   | |     |     | | |   | +---------------------------|---------------|-------|-|---------+ +---|---|-|-|-|-+ \n" +
                "     | | |       | |                 | |   | | |       | | |       |   | |   |         |     | |     |     | | |   |     |                     | | |   |     | | |       | | |   |   | | | | | | | | |   \n" +
                "     | | |   +---|-----------------+ | |   | | |       | | |     +-|---|---------------|-----|-|-----|---------|---------|-+                   | | |   |     | | |       +---|---|---|---|-------------+ \n" +
                "     | | |   |   | |               | | |   | | |       | | |     | |   | |   |         |     | |     |     | | |   |     | |                   | | |   E     | | |         | |   |   | | | | | | | | | | \n" +
                "     | | |   |   | |   +-----+     | | |   | | +-------|-|-|-------------|---|---------|-------|-----|-----|-------|-----+ |                   | | |   |     | | |         | | +-|---|-|-|-|-+ | | | | | \n" +
                "     | | |   |   | |   |     |     | | |   | |         | | |     | |   | |   |         |     | |     |     | | |   |       |                   | | |   |     | | |         | | | |   | | | |   | | | | | \n" +
                "     | | |   | +-|-----|-----|-------|-|-----------------|-|-----------|-----+         | +---|-------|-----|-------|-----+ |                 +---|-------------|-------------|-------|-----------|---+ | \n" +
                "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
                "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
                "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
                "     | | |   +---|-+   |     |     | | |   | |         | | |     | |   +-|-------------|-|-----------+     | | |   |     +-------------------|-+ +---------------|---------|-|-|-|---------|-----+ |   | \n" +
                "     | | |     | |     |     |     | | |   | |         | | |     | |     |             | |   | |           | | |   |       |                 |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
                "     | | |     | |     |     |     | | |   | |         +-|-|-----|---------------------+ |   | |           | | +---------------+             |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
                "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
                "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |   +-------|-|---------|-----|---|-|-|-|---+ +-|-+ | \n" +
                "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |         | | |         | | | |   | | | |     | | | | \n" +
                " +-------+     | |     |     |     | | +---|-|-------------|-----|-----------------------|---------------------+   |       |   |       +-----------|-------------|---------|-|-|-|-------|-----+ | | | | \n" +
                " |   | |       | |     |     |     | |     | |           | |     | |     |               |   | |           | | |   |       |   |       |     |     |         | | |         | | | |   | | | |   | | | | | \n" +
                " |   | | +-------|-----------+     | |     | |           | |     | |     |               |   | | +-----------|-|-----------|---|-------|-----------|---------|-|-|---------|-+ | |   +-|-|-|---|-|-+ +-+ \n" +
                " |   | | |     | |     |           | |     | |           | |     | |     |               |   | | |         | | |   |       |   |       |     |     |         | | |         |   | |     | | |   | |       \n" +
                " |   | | |     | |     |           | |     | |           +-------+ +---------------------|---|-|-|---------|------M------------+     +-|-----------------------|---------------|-|-----|-|-|--W--------+ \n" +
                " |   | | |     | |     |           | |     | |             |             |               |   | | |         | | |   |       |         | |     |     |         | | |         |   | |     | | |   | |     | \n" +
                " |   | +-----------------------------------+ |             |             |               |   | | |         | | +---|-------------------+     |     +-----------|-----------|-------------+ +---|-------+ \n" +
                " |   |   Q     | |     |           | |       |             |             |               |   | | |         | |     |       |         |       |               | | |         |   | |     |       | |       \n" +
                " |   |   |     | |     +-------------|-------|-------------|-------------+               |   | | |         | |     |       |     +---|-------|---------------|---|-------------|-|-------------------+   \n" +
                " |   |   |     | |                 | |       |             |                             |   | | |         | |     |       |     |   |       |               | | |         |   | |     |       | |   |   \n" +
                " |   +---+     | |                 | |       |             |                             |   | | |         | | +---|-----------------|-----------------------|---|---------|---|-+     |       | |   |   \n" +
                " |             | |                 | |       |             |                             |   | | |         | | |   |       |     |   |       |               | | |         |   |       |       | |   |   \n" +
                " |             | |                 +---------+             |                             |   | | |         | | +-----------|-----|---|-----+ +---------------|-------------+   |       | +---+ | |   |   \n" +
                " |             | |                   |                     |                             |   | | |         | |     |       |     |   |     |                 | | |             |       | |   | | |   |   \n" +
                " |             | +-------------------+                     |                           +-----|-|-----------|-|-------------|-----|---|-----+     +-----------|-|-|-----------------------|-----|-+ +-+   \n" +
                " |             |                                           |                           | |   | | |         | |     |       |     |   |           |           | | |             |       | |   | |   |     \n" +
                " |             |                                           |                           | | +-|---|---------+ |     |       | +-------|-----------+ +-----------------+         +-------|-|---+ +-+ |     \n" +
                " |             |                                           |                           | | | | | |           |     |       | |   |   |             |         | | |   |                 | |       | |     \n" +
                " |             | +------A----------------------------------|---------------------------------+ | |           +---------------|-------|---------------------+ | +-|---+                 +-|-----+ | |     \n" +
                " |             | |                                         |                           | | |   | |                 |       | |   |   |             |       | |   |                       |     | | |     \n" +
                " |             | |                                         |                           | | |   | |                 |       | +---+   +-------------+       +-+   +-----------+           |     +-+ |     \n" +
                " |             | |                                         |                           | | |   | |                 |       |                                                 |           |         |     \n" +
                " +-------------+ +-----------------------------------------+                           +-+ +---+ +-----------------+       +-------------------------------------------------+           +---------+     \n" +
                "                                                                                                                                                                                                         ");
        assert result == 18058 : "unexpected result is " + result;
        System.out.println(result);
    }

    private static int test(String s) {
        String[] table = s.split("\n");
        int y = 0, x = 0;
        for (; y < table[x].length(); ++y) {
            if (table[0].charAt(y) == '|') {
                break;
            }
        }
        int count = 0;
        boolean down = true, up = false, left = false, right = false;
        while (x >= 0 && x < table.length) {
            if (y < 0 || y >= table[x].length()) {
                break;
            }
            if (table[x].charAt(y) == '+') {
                if (down || up) {
                    if (table[x].charAt(y - 1) != ' ') {
                        left = true;
                        down = false;
                        up = false;
                    } else if (table[x].charAt(y + 1) != ' ') {
                        right = true;
                        down = false;
                        up = false;
                    } else {
                        break;
                    }
                } else if (left || right) {
                    if (table[x - 1].charAt(y) != ' ') {
                        up = true;
                        left = false;
                        right = false;
                    } else if (table[x + 1].charAt(y) != ' ') {
                        down = true;
                        left = false;
                        right = false;
                    } else {
                        break;
                    }
                } else {
                    throw new RuntimeException("unreachable");
                }
            } else if (table[x].charAt(y) == ' ') {
                break;
            }
            if (down) {
                ++x;
            } else if (up) {
                --x;
            } else if (left) {
                --y;
            } else if (right) {
                ++y;
            } else {
                throw new RuntimeException("unreachable");
            }
            ++count;
        }
        return count;
    }
}
