package advent.advent2023

import utils.Point
import kotlin.math.max
import kotlin.math.min

private var result = 0L

fun main() {
    result = test(
        """
            ...#......
            .......#..
            #.........
            ..........
            ......#...
            .#........
            .........#
            ..........
            .......#..
            #...#.....
    """.trimIndent(), 10
    )
    check(1030, result)

    result = test(
        """
            ..............................................#......#...............................................#..........................#...........
            .....#......................................................#.............................#.................................................
            ............#...................#........#....................................#..............................#...........#..................
            ...............................................................................................#............................................
            .#....................#...........................#......................................................#...........#.....................#
            ............................................................................................................................................
            ...................................#.......................#...........................#....................................................
            ....#...................................................................#......#..................#.............#...................#.......
            ..............................................#.............................................................................................
            ...........#.............................#......................#...........................................................................
            ...................#.........#..............................................................................................#...............
            .....................................................#.....................#...................#..........#...............................#.
            ...............#................................#.......................................................................#...................
            ....#..............................#......................................................#...........#..........................#..........
            ..............................................................#.............................................................................
            ...........................#.................#...............................................................#.....#..................#.....
            .......#...........#..............................................................#.........................................................
            ..............#...........................................................................................................................#.
            ...............................#..................#.........................................................................................
            ..#............................................................................#............................................#...............
            .........................#..........#.....................................#.................#...................#...........................
            .................#......................................#............................#................................#................#....
            .......................................................................................................#....................................
            .....#................#........................................#............................................................................
            ........................................................................#................................................#..................
            ...........................................#...................................#..............................#.............................
            ..........................#..............................#..........................................................#.....................#.
            ..#............#......................................................................#..........................................#..........
            ................................................#..............................................#............................................
            .......................................#..............................................................................................#.....
            .....#......................#.................................#............................................................#................
            ................................................................................#..........................................................#
            #.........#...........................................................................................#.....................................
            .....................................................................................................................#...........#..........
            ...........................................................#..............................#.................................................
            ..............#.......#.........#........................................#...........................................................#......
            ......................................#.....#.....................#..........................................................#..............
            ...........................#............................#.........................................#......................................#..
            ...#...............#...........................................................#.....#..........................#...........................
            ...................................#........................................................................................................
            ............#....................................#.............#..........................................#..........#..............#.......
            .......................#................................................................#...................................................
            ......#...............................#...............#.................................................................................#...
            #..............#...........................#................................................................................................
            ............................#.............................#................................................................#................
            ..........#........#..............................................#...................#........#...............#............................
            .......................................................................................................................#....................
            .........................................#..............................#.....#.............................................................
            .....................................................................................................................................#......
            .....................................................#......................................................................................
            ........#.....#....................................................#..................................#.....................................
            .....................#.........................#.......................................#...................................#................
            ...#.........................#..........................#..........................................................#............#...........
            ............................................................................................................................................
            ...........#...................................................#.............................#..............................................
            ..................#.........................................................................................#...............................
            ..........................#................................#..........................................#.....................................
            ................................#.....#...................................#............#....................................................
            ..............#............................#.......................#............#............................................#..............
            .....#..................................................#.........................................#............#.....#.....................#
            ............................................................................................................................................
            ........................................#...............................................................#...................................
            .....................................................#......#.................................#.............................................
            ..........#............................................................................................................#........#...........
            ............................................................................................................................................
            .#................#.......#.......................#...................#.....#.........................#................................#....
            ...............................#..................................................#..............................#..........................
            ........#....................................#....................#......................#..................................................
            ............................................................................................................................................
            .........................................................#...................................................#.........#....................
            ..............................................................#..............................................................#..............
            ......................................#...........#.........................#........................#................................#.....
            .....................#......#...............#...............................................................................................
            ............#.......................................................................................................#...........#...........
            ...................................................................#......................................#...............................#.
            ...#................................#..........................................................................#............................
            .........#.....................................................#............................................................................
            ..............................................................................#....................#........................................
            .................#.....................................#.............................#.............................#....................#...
            ........................#......#.............#..............................................................................................
            .....................................................................#.....................................#...............#................
            ............................................................................................................................................
            #..............................................................................................#............................................
            .................................#......................................#..............#....................................................
            .................................................#.....................................................................................#....
            ...#...............#.....................#......................................#........................................#..................
            ........................#......................................#...........................................#.......................#........
            ....................................................#.....................#................#.........#......................................
            ............#...............................................................................................................................
            ...........................................................#.........................#.........................................#............
            .....................................#............................#.........................................................................
            ......#.............................................................................................................#.......................
            ....................#...........#.............#...............#.........................#................................#...........#......
            .........................................#.....................................#............................#...............................
            ...........#............................................#...................................................................................
            .................................................................................................................................#..........
            ...#..............................................................#.............................#.................#.........#............#..
            ......................#..............................................................#................#................#....................
            .........#.....................#......................................#.....................................................................
            .........................................................................................#..................#...............................
            .................#.........................#..............#...............................................................#.................
            .....#...............................................#............................#.........................................................
            ....................................................................................................................#.......................
            ..........#..........#.......#................#......................#........#............#.......#........................................
            ...................................#.....#..................................................................................................
            .............................................................#.........................#.........................#......#...................
            .........................................................................#.......#.......................#........................#.........
            .......................#.........................................................................#...........................#..............
            ........#.........#.........#...................#...........................................................................................
            #.........................................................#............................................................................#....
            ........................................................................................#............#......................................
            ..................................#........................................................................................................#
            ..............#.....#.....................#..............................#.......................................#..........................
            ...#..........................................................#.............................................................................
            .........#.......................................#............................#...............#..........................#........#.........
            ...........................#.................................................................................#..............................
            .........................................................................................#...........................#......................
            .....................................................................#.................................................................#....
            .....#..................#.......#.........#.................#................................................................#..............
            .....................................#................#....................................................#.......................#........
            ...............................................#............................................................................................
            ...........#........#.......#...................................................#...........................................................
            ................................................................#...........................................................................
            ................#............................................................................#..............................................
            #......................#...............................................................................................#....................
            .................................#...............................................................................#............#..........#..
            .....#..........................................#..........#..........................................#.....................................
            ...........................................#...................................#.................#..........................................
            ..........#.......#...........#...............................................................................#.............................
            .......................................#............................................................................................#.......
            ...................................................#.....................................................................#..................
            #......................#........................................#..........................#...............#................................
            .............................................................................................................................#..............
            .............................................#.........................#..............#.....................................................
            .......#.............................................#.......#...................................................................#..........
            ............#.....#.....................#..............................................................#............#.....#.................
            ...#.........................#................................................................................#.............................
            ...............................................#..................#.........................................................................
            ...................................#....................................#.......#........#.........#..........................#.............
            ..........#.....#......................................................................................................#..............#.....
    """.trimIndent(), 1000000
    )
    check(550358864332, result)
}

private fun test(input: String, times: Int): Long {
    val lines = input.split("\n")
    val emptyRows = mutableListOf<Int>()
    val emptyCols = mutableListOf<Int>()
    for ((row, line) in lines.withIndex()) {
        if (line.all { it == '.' }) {
            emptyRows += row
        }
    }
    val galaxies = mutableListOf<Point>()
    for (col in 0 until lines[0].length) {
        var hasGalaxy = false
        for (row in lines.indices) {
            val ch = lines[row][col]
            if (ch != '.') {
                hasGalaxy = true
                galaxies += Point(col, row)
            }
        }
        if (!hasGalaxy) {
            emptyCols += col
        }
    }
    var sum = 0L
    for (i in 0 until galaxies.size - 1) {
        for (j in i + 1 until galaxies.size) {
            sum += galaxies[i].manhattanDistance(galaxies[j])
            for (row in emptyRows) {
                if (row in min(galaxies[i].y, galaxies[j].y)..max(galaxies[i].y, galaxies[j].y)) {
                    sum += times - 1
                }
            }
            for (col in emptyCols) {
                if (col in min(galaxies[i].x, galaxies[j].x)..max(galaxies[i].x, galaxies[j].x)) {
                    sum += times - 1
                }
            }
        }
    }
    return sum
}
