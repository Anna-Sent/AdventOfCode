package advent.advent2023

private var result = 0

fun main() {
    result = test(
        """
            ???.### 1,1,3
            .??..??...?##. 1,1,3
            ?#?#?#?#?#?#?#? 1,3,1,6
            ????.#...#... 4,1,1
            ????.######..#####. 1,6,5
            ?###???????? 3,2,1
    """.trimIndent()
    )
    check(21, result)

    result = test(
        """
            ##.??.??##? 2,2,4
            ???????##?????#?#? 9,6
            ???#?????? 1,1,1
            #???..??##..?# 1,2,3,2
            ??.#??#??? 2,1,3
            #??#???????????.??? 14,2
            ??????#?.#?#.????.? 7,1,1,2,1
            .??..???????? 2,1,3
            ???#??#?#?#?.. 1,7
            ????#??#?#?#???####? 4,13
            .#..?.???# 1,1,3
            .#?##.???.????#. 4,3,2
            .??#??#?????????# 6,8
            ?#?.??#?#.???? 2,4,1,1
            .??##?#????.?? 5,1
            ??#?.???##???? 4,3,1
            #?#?#?..?.?#? 6,1
            ?.#??.??##??????? 1,1,1,8
            ?????#???????????#?# 1,4,1,2,1,1
            .???.?.????#?? 2,1,1,3
            ..?#?.#?#??#?.?? 3,7
            ???#?#?##?##???#??? 1,1,12,1
            ?.??.???#. 1,1,2
            ???#?###????# 1,1,5,2
            ?.????#?????#??##? 7,6
            ??#??#?.??? 6,2
            ???#??.???????#? 4,1,1,1,2
            ##?##?#??.??#.#? 8,3,1
            ??#????##.?? 9,1
            ?..???????? 3,1,2
            ????##?????#?#?#??.? 3,7
            .?..?.???.?#???????? 1,1,2,6,2
            ?.?#????#.??? 4,1,1
            #??#??#????.#?? 8,3
            ????????.??.##?? 2,1,1,2
            ???.???#??? 1,5
            ?????#.#?? 2,1,1
            ??#?.?#?#?????.#?? 2,4,3,1,1
            ?#???.???.##? 3,2,2
            ???#?#???????.?. 4,6
            ?#????###?.???#?#??? 8,9
            .?????????? 8,1
            ?#???##?#?? 1,2,2
            ??.?##??#??? 2,2,3
            ?????#?#???#?. 7,2
            #??????????.#.?..?#. 9,1,1,1,1
            ?.?##?#???.??#??? 1,6,5
            ???.??#?#?#.#??.. 3,7,2
            ?.???##?#.#? 1,6,2
            ???#???????.?#????#? 1,2,4,7
            ??#?#???#?.? 8,1
            ?.?#.?.#???..? 1,4
            #.?.????#??###.???## 1,2,6,2,2
            ???????.????. 5,4
            ??.#?????#?#????#?? 1,10,1,3
            ???#???.??? 3,1,1
            ?????.#??#.? 1,4
            ???#?.?#???????? 3,4,1
            .???????#?????.?#?? 4,4,1,2
            ?????????.?.#???#?? 7,1,1,2
            ###.?#???#. 3,6
            ...##?##?#???? 5,5
            ?#??#????.? 1,4,1
            ?.?????????#? 6,4
            .?????###?#? 1,6,2
            .?????#???? 5,1
            ??????.???????. 1,1,1,2,1
            ?.##?#??##??#??##?# 4,11
            ?##??#?.#??.?### 2,1,1,1,3
            ?.?.??????. 1,3
            .?.?.?#????.??#?... 1,2
            ?.???#?##???#.?.? 1,5,1,1
            .?..?###????#??????? 12,1
            ?#???#.?#.?# 2,1,1,1
            ??..#????#?????..?.? 2,7,1
            ????????.?????????? 8,3,1,1
            ##???..??? 2,1,2
            ??#???#???? 1,2,1
            .????#??###.??# 10,3
            ??????.##???????#? 5,5,3
            .##???????####.?. 3,9
            .#?#???##?.???#?#?? 3,3,7
            ????#?#?????.?#?? 1,10,3
            ???#??.#.???##?.#? 2,3,1,1,3,1
            .#?.??????????#????? 1,13
            ??????.?#??##?#?.? 3,1,5,2
            .??.?#??#?????????.? 1,5,2,1,1,1
            ??????#.?? 2,2
            .#?##??#?#??..#?.??? 5,5,1,1
            ????.????#??# 1,7
            #????...?????#? 4,2,1
            ??#???.????#??.??. 3,1,2,1,1,1
            .?????.????. 1,1
            ??#???#?.? 1,2
            ?.#???#?????? 1,7,1
            .??##?.#?.??#??#???? 4,2,7
            #??#?#??????.#?#?? 1,5,1,1,1,3
            .?#??##????...??##?. 9,4
            ?##??????#?#?##? 2,2,3,1,3
            .?#??#.#???? 4,1
            ??????.?#???.?#.#??# 4,3,1,1,2,1
            ??????.#???.??? 5,1,1,1,1
            ?.??????.#? 1,2,1
            ?##?.????. 3,2
            ??.???????#???#? 1,1,2,7
            ??#.#?#??#??.? 2,7,1
            ??#??#?.?#?. 6,2
            .?#??????? 1,1,1
            .#??.????#?#.? 2,2,3,1
            ##??#??.?? 5,2
            ?#?#??#??#### 7,4
            ???###???..? 8,1
            ##???????. 2,1
            ???#???.?????.??# 1,4,5,2
            ?..??????????##??? 1,1,4,4
            ?#??????##??..??. 1,7,1
            .?#??.???#?#???#?.? 3,8
            ?###???#???####. 8,5
            ?.????#?#??????????? 1,1,1,9,1,1
            ??#?????##?#??. 1,7
            ?####????#????##???. 7,3,5
            ????.???#? 2,5
            ??#????#???..??#?? 1,2,6,5
            .?.???#?..???? 1,4,3
            #?#????##???. 3,1,4,1
            ??.#?????#?. 1,8
            ???????#??#? 3,1,1
            ?#?#??.?.?.????.. 6,3
            ?#?????????? 2,2,4
            ??#?#??#????????# 12,2
            ????##???.????? 1,5,3
            #?##..?#.? 4,1,1
            ??.#???.#????#? 1,4,1,1,3
            ??##?????#?### 1,4,1,3
            ??###??.?#.#????#?. 7,2,2,1,2
            ????##????.# 6,1
            ??????????? 2,2,2
            ???.???..?.?#.?..?? 1,1
            ???#???#.?.#??? 1,1,2,1,1
            #?.?..??.???????. 1,1,1,2,3
            ?##??????#??? 4,1,4
            ???????##????? 1,8
            ##?????#????.#?? 8,1,1
            .#..#?#?#.?.##??#?? 1,1,3,1,6
            ???##??.???? 1,3,1,1
            ?#????.#??? 5,3
            ?.??##??.?#??#?.??.# 6,2,1,1,1
            ??#?#?.??.#??...? 3,2,1,3
            ?????#??.. 3,2,1
            .??#?...?#?#?. 4,5
            .????#???.???. 6,3
            ????.?#???...?.?. 5,1
            ??.??.?###???#?? 1,2,7,1
            ????.?.?#?# 1,1,3
            .???#?#...??##?#? 6,6
            ###???.??.??#?????? 3,1,1,2,1,1
            ?#..???.???# 1,3,2,1
            ##??#????. 2,3
            ##??????###???##..# 7,8,1
            ?????#????..???#???? 9,4
            .?#??##?.?##??#. 2,4,3,1
            ?#????.#??.????#.? 4,1,3,2,1,1
            #?.#???.??#?.??. 1,1,1,4,2
            ?.??#??#?#??.?#?. 9,1
            .#???#.???.?#?#..?. 1,3,3,1,1,1
            ?????#?.?.?# 3,2,1,2
            .???????.??## 1,5,3
            ??.?????#.??? 1,5,2
            ??.????##..?#.??# 1,3,2,2,2
            .#????.?#???..???? 5,5,2,1
            ????#?##???#. 5,2
            ?.?.????#????#. 1,1,1,2,1
            #.?#.???#???##?# 1,2,10
            ?????.?.???????????. 1,7
            .??#??.?.????? 5,1,1,1
            ???????#.. 4,2
            ?.#??????.??#?##??. 5,6,1
            .????????????? 3,1,1,1
            ?#????????.?? 1,2,1,1
            #.????.??#..? 1,1,1,1
            .?#.?.???????? 2,1,4
            ??#?#??#?#????..? 1,1,1,8,1
            ##??????.#.? 2,3,1,1
            ??#???.??...??.? 1,4,2,1,1
            ????#?#?#..?.????. 9,1,1,1
            ????.#.?#??#???????? 2,1,10,1
            ?????#.??????.. 1,2,2
            ??.?###..#???? 4,3
            #???#??.???????? 6,4,3
            ?#????#??? 1,3
            ??##?.?#?#????.??. 3,5,1,2
            ##.?.###?????.?#?? 2,5,3
            ??.#??????#??????. 8,1
            ?#?#???.??#?????.. 7,7
            ##?...???##???##??? 3,12
            .???#??????#???.???# 5,5,1,4
            ??.??..????? 1,1,2
            ??????????.??? 5,2,2
            #????.???? 5,2
            .?#?#????# 7,1
            #???###.?##?# 1,3,3,1
            ???#???.#.?# 3,1,1
            #??????#?#?#??????## 1,7,1,6
            ?????#?#?? 6,1
            ??#?#?.??????#?.??? 6,2,1,2,1,1
            ????????#????##.?#?. 1,11,1
            ?.?#?????? 1,2,1
            ??????##??.??????. 1,1,4,4
            ??##???##???#.#?.?.# 11,1,1,1,1
            ?.?.??#??..??##?#. 1,2,6
            #???##??????? 2,3,1,1
            #?..????#??#.?### 2,2,3,1,4
            ??#???#??????#.????? 12,3
            ?#?#??.#?? 4,2
            ??????#??.???..?#?# 7,2,3
            .???#?..?????#?.. 5,1,1
            ?.?????..?????. 2,1,1
            ??#??.??##???.????. 2,6,2
            .????????.#?? 1,6,1,1
            .???????##???? 8,1
            .??##?.?????#?? 2,4
            .??????#????###?. 1,4,6
            ?#?..###??#???##?? 3,4,1,3,1
            ??????????##?????. 2,3
            ???#????#?#?# 1,6,1,1
            #?##?????#????#???#? 5,1,1,9
            #???#?#?#????????? 1,1,7,1,2
            ???..#?.?#?#.#?#??? 1,2,4,3,1
            ?#.???#???##?#??. 1,1,6
            ????##?#?#?.?.? 2,3,3,1
            ??????##???? 1,9
            ??###???.?#?? 5,1,2
            #.#?.??.#? 1,2,2
            ?.??????.?.????.?... 2,2
            ????#??????.? 6,2,1
            ?????.?????#?.#??? 1,2,7,1,1
            .?#?#???????? 3,2
            .?????#?.?.?#????? 6,5
            #?#??..??##??. 1,2,1,4
            .???#..??#?#? 3,5
            ???#????#?.???##???? 10,1,4,1
            ?.?#?.??..???? 1,2,2
            ???#??.?#?.??? 6,1,2
            .????#???##???????? 6,3,4
            #???#?.???????###?? 1,1,1,1,1,6
            ??#???.?.?.??#?? 3,1,1,4
            ?.??##?????.?.?#?. 1,9,2
            ??????.??#???#.#.. 4,6,1
            ??##??.??# 4,1
            .?#???.#???#?## 3,1,1,1,2
            ???#???##???#. 3,6,1
            #????..???#. 3,1,2,1
            #.??#??#??#?? 1,2,1,1
            ?.##???#?. 1,2,3
            ?????????#????.?. 14,1
            ??##???#???.??# 8,1,2
            ..?#???#?.????. 2,3,1,1
            ?.??????.???#??.. 1,1,5
            ??..#???#????## 2,5,2
            ????#?#???#?#??#? 2,2,8,1
            ????????#??????? 1,3,7
            #?#?###???#?? 1,9
            ????.????.?#????#?# 4,1,2,4
            ??#.?#?#????? 3,2,2,2
            #??#??.?.?#?#??#??? 6,1,6
            .#??.??????? 3,2,1,1
            ??.#?#.????.??? 3,4,1
            ??..#?.?#.?#???? 1,2,1,1,2
            ??#??#?????#?.??? 3,4,1,1,1
            .??.???#???..?? 1,5,1
            ??.????..??.#???#? 1,3,1,1,2
            ????###???#???? 1,9,1
            .?##????.?##? 4,1,4
            ?.?.???.#?#?? 2,4
            ..??#???#??.#. 8,1
            ?????????#? 4,1
            ?????#???.??# 6,1,3
            .????.????#. 1,1,2
            ??.????##?? 1,6
            ?.#??.?????#?## 1,3,1,6
            ??#????????#.???#??# 5,1,1,2,4,1
            ?#..?#.?#? 2,1,1
            ?..?#?#?#?#??#???? 10,1
            ?#?.???.?????? 1,1,1,4
            ?.?.??#?.????.??. 3,2,1
            ??#?#####???#?????.. 10,1,1,1
            .???#?????#??? 2,3
            #??#???.?????? 1,2,1,2
            #.#.?.???#??? 1,1,1,6
            ..???????. 5,1
            ?#?????#.?#???##?##? 5,2,3,6
            ??#??#???#.??#?#?. 1,8,6
            ?#??..??.. 2,2
            ?.##???.###? 2,1,3
            ????..??????#? 1,1,5
            ?.????????.???.?? 5,2
            ??.?..???????? 1,2,3
            .?.##?.?.?. 3,1
            ??????#??.????.? 6,1,1,1,1
            ..???#??#..#??##?? 4,7
            ?#??#?#.#????.????# 4,1,3,5
            .??.????.? 1,3
            ?#?.??????#??##? 2,1,3,5
            ??##.???????#.??? 3,2,5,1
            ??.???????#???#? 1,1,1,3,1
            ?????..???? 2,1,1
            ?.????.?.??#?????? 3,4,1
            #?#?.?..#?????????#? 3,1,1,9
            ???.?#???#. 2,1,1
            ?#???#??#?????#???# 2,11,1
            ?#.??#????#??? 2,1,3
            ##?.?##??.? 3,4
            ???#?#???..?#??? 5,2,1,1
            .#????.#?#??#??? 3,6
            ..#??#???? 1,2,1
            #??.???#?##.?# 1,7,1
            ??.???.???????.??? 1,1,1,3,1,2
            .??.?.????.#???.?#?# 1,1,3,4,1,1
            .???????##?.? 5,2,1
            ?.??????#?? 1,3
            ???.#???????# 1,1,5
            ???#??#.#???? 1,1,1,2
            ??.???.???????#??? 1,1,1,1,6
            .???#?.???##? 4,4
            ???.???##?##???.???? 10,1
            ??###???#??????#.?? 5,5,1,1
            ?#??????#?#?.??? 2,8,1
            ?###??#???????#. 9,1,1
            .???????#?###??? 1,1,1,6
            ?.?????##??#??#?? 1,13
            ???????##???.??#??? 11,2
            .???#?#?.??.?? 6,2
            ?????????#####?#.? 1,11,1,1
            ??#??.?????##?#???? 1,1,1,5,4
            ?#??##?.???# 2,2,4
            #.?????#?????? 1,1,5,1
            .#??????##.? 3,1,2
            ???##???..??##.??. 6,3,2
            ??.??.#?#????.?????. 1,2,5,1,3,1
            ?..##?????.#??##?## 1,3,1,8
            ?.????#???.??? 1,4,2
            .???#?.?.?.? 4,1,1
            .??##??#?#?????#??#? 14,1
            .?#???..???????#?? 4,1,6,1
            ???#??.?????..#???#? 2,1,4,6
            ???.#???##?#?.?.#. 1,1,3,5,1,1
            ???..??#?#?????????. 1,3,10
            ???????#??.??#?#?? 3,1,1,3,1
            ??.?.????. 1,1,1
            ??.??.#??#? 2,1,2
            ??#????#??#??# 4,8
            ?#???#???#???? 2,7
            ???#??##?????? 1,7,2
            ??????.??##??????#. 2,11
            ?#???##???##? 3,8
            .?#?..???.??????##? 2,2,8
            ??.?##?..#?###?...? 3,6
            ???##???#????? 11,1
            .#???#????#?#?????? 1,1,14
            ?.????#?.???######?? 3,8
            ?.??????###????.? 2,9
            ?.#.????.???.? 1,3,1,1
            ????.??..?# 2,1,2
            ??.?????.????#? 1,2,2,5
            ?#????????# 5,3
            .??##????????? 4,3
            #????????? 2,1,1
            .???#??#???#?...? 9,1
            .??#?.?.##?.? 2,3
            ??.?#??#???? 1,2
            .#????????????. 4,2,4
            ?.????????????#? 1,1,6,2
            ???#.??#??? 2,2
            ?..#????#??#? 1,1,4
            #???###??..?.# 9,1,1
            ?#?#??????? 3,1,2
            ???.??????#? 1,1,2
            .#????????#. 2,1,1,1
            ??..?#?.#?????#.?#? 1,2,7,1
            .??#..#???? 2,4
            ?#??????..? 2,2,1
            ?#??#?.???????? 3,1,3,1,1
            ?#??#?#?????#??..?. 7,3
            ??.#.?.#??##??#?#. 1,1,1,5,1,1
            ?#.????.?? 2,1,1
            ??#?.???#???. 3,4
            ...???.??????#.#?#? 3,7,4
            ..??#?#????.???? 6,1
            #??#?.#??#??####?. 1,1,1,8
            ????#.#?#?.??#.. 4,1,1,2
            ?????#?#??#?? 4,6
            .????#???.?????.???? 1,4,1,1,1,4
            .???#????? 1,1,2
            ???.??????. 2,5
            #?#???#??##??. 11,1
            ?.?????.?# 2,2
            .?????????#????????? 8,3,5
            ??????#??#?#? 8,1,1
            ##?????#?. 2,1,3
            ?????###?.??????? 7,2
            ??#?????.?#?.????? 1,6,1,5
            .?..????#????#.???? 9,1
            ??.?????#.?.?? 1,1,1,1
            ??.????..#??.. 1,2
            .?#.#?#?##???# 2,1,5,1
            ??..???#?????.?? 1,1,1,3,1
            ?#?#??#?#??????????. 2,9,1,2
            ???#?????.#..??#???? 8,1,4
            .??.???#?????. 1,1,3,1
            ?????.#??# 2,1,1
            .??#.????. 2,3
            .##?????.?# 2,2,2
            ?#????#??#??????? 1,11
            ????????#??????.?.?? 8,1
            ??#?#?#??###?##???#? 13,1
            ??#.??#???#? 1,1,2,4
            ???##.???????. 1,2,2,4
            ?#?.?????.??#.? 3,1,3,1
            ????.???..#?? 2,2,2
            ???..??????..?.?#?# 2,2,1,4
            ??????#??#.??#??.. 4,2,4
            ????#.???#???.?#??? 5,6,2,1
            ??#??.???? 3,1
            ??..#????###?????# 2,2,1,7,1
            ?##??#??#??# 5,3,1
            ???#???.???.#?#? 4,1,1,2
            .????##.?.?#??? 6,1,1,1
            ?.??.#.?.?.# 1,1,1,1
            ?..????..? 1,1,1
            ??.??.???# 1,1,4
            .?#???????? 2,2
            ?##.???..?# 3,1,1
            ??#??#????. 2,3
            ????##???#?.?.#?? 9,2
            #.?.##?#.??? 1,2,1,2
            ?#??#??#??#.?? 7,1,1
            ???.##?.???.?#??#? 2,3,3,1,1
            ??#?.###???#??# 1,1,10
            ?##?.????.?? 3,1,1,1
            ??????.?????#????.?# 2,1,2,3,1,1
            ?#??.???###.# 1,1,3,1
            ????.????. 1,1
            ?#???.?????? 2,5
            ?????#???????? 1,5,1
            ????????..???????? 1,1,1,1,4
            .#?????#?????? 9,1
            ?????#?.?#??#?? 1,2,3,2
            ???#????.?#.? 5,1,1
            #???##?#?.?.?.????# 1,7,1,1,1,1
            ??.??#?????.???? 1,5,1,1,1
            ?.????#??????#? 1,1,2,5
            ..??????.. 2,2
            .????#???.??#???#? 7,5
            ?#?.?##??????.??#? 2,2,3,1,1
            ???.?#?????? 2,6
            ?#?#?#.?????.??. 6,1,1,1
            ?.??##..???#?##??? 3,7
            ?#????#?#??..? 2,5
            ??#???#??#??.?? 3,6
            ?.??????#?###???.?? 1,1,6,2,1
            ???????????#??? 3,2,2,1
            #???..????.#.#?? 1,1,1,1,3
            #?.?????.#? 2,1,2
            .??.????#?? 2,3
            #..????????????.? 1,4,5
            #.??.#????#??##?.? 1,1,4,1,4
            ??#?..??.?? 4,1,1
            ??#.?#????????? 1,1,5,1,2
            .??????#?##???.?? 1,5,1
            ?#.#??...?#???#? 2,1,1,4,2
            #??#?????..# 1,4,1,1
            ?#.???..?? 1,2,1
            ?##??..?##???.#.? 4,5,1
            ??#???..#. 5,1
            ?.???.#??#.???.? 1,1,1,1,3
            .???.??##?#?. 3,3,2
            ??.#.?..?? 1,2
            .?#??#???# 6,1
            ##????#.??# 7,2
            ##??.???.?##? 4,1,3
            ???#?#?..??????# 1,4,1,1,1
            ??.???????.?##??? 1,3,3,6
            .?#?#????#??#??? 4,4
            ??.?#?????..???# 4,4
            .??.??.???#. 1,1,1,1
            .?????.???????? 3,8
            ?..?#..?##?.??? 1,1,3,2
            ???.#??..???. 2,2,2
            ????????.?.?#??.? 3,1
            ??##?.????#? 5,1,2
            .???#.???. 4,1
            ?#??.?.?.?##?? 2,1,5
            ?#?###.#???????#.# 6,2,3,1,1
            ??????.??#??.?### 1,4,3,3
            ??????#??..????. 5,3
            ???????#??..??? 8,1
            ??#???#????#?#??.??. 14,1
            ??#..??????#??##?? 1,1,9
            ?##??#??.#?????##.?. 7,2,4,1
            .?##????.#. 3,1,1
            ?.????.#?##?#. 1,1,2,1
            ?#?#..????#.? 3,2,1,1
            ????#?###?..##?? 1,1,4,2
            ?#..???????? 1,1,1,2
            ???????#????? 6,1,1,1
            ????.#??#?.. 3,1,2
            .#?.?????#???#? 1,1,7
            ?#??##???#.??? 7,1,1
            ??..????#? 1,2,1
            .?#???????? 3,1,1
            ???.????.?.??? 1,3
            ???????#????.? 4,5,1
            .????????#.??#?????? 1,1,1,1,5,1
            ????#?????#?#??##?? 4,9
            ???.?.#?????? 2,3,2
            ?#???.#.??..? 1,1,1,2
            ????#??????????#. 9,2
            ???.????#..?##. 1,4,3
            ????.??.????.?? 1,2,1,3,1
            ?###????#????#?## 4,4,4
            ??#????????#?? 1,3,1,5
            ??#?????#??###..?? 14,1
            ????#.?#.??.?### 2,1,2,1,3
            ?.?.#?.?#? 1,2,3
            #????????###..?.. 4,2,4,1
            #????.??##?##?# 1,2,1,7
            ???????.??.??? 5,2
            ?#?.##????.?#. 3,2,2,1
            ?#?#??#??#??.? 7,4
            ??.???#????. 1,7
            ?.?#.????##?????.# 1,7,1,1
            ????##????? 8,1
            ??????????##???#?? 3,12
            ...##..??#???#? 2,6
            ?#?????.??. 2,1
            ???.?????. 2,1
            .?##???????##???. 3,2,2,2
            ??.????.?..#?.... 4,2
            ?##????????##???.# 4,1,6,1
            ??#??????#?#?? 1,8
            ???.#?????#??.??? 2,9,1
            .##?.??..????# 3,1,1,3
            ?#?.?#???#?.???? 2,6,1
            ?.?????.????#? 4,2,1
            ##?##?.????##?.? 5,7,1
            ???????????.# 2,1,1,1
            #???#???.#.???# 1,6,1,1,1
            ??????##???.?.?# 8,1,1
            ?#???###.??? 2,4
            #?.#?????.?#.???..# 1,1,4,1,3,1
            ?????#.?.??#?# 1,1,5
            ??#????????.???#??? 5,3,2,1
            .????.??##..???? 3,3
            .#.????#??#??? 1,8,1
            ..???#???????.. 4,4
            .?#?.??#?????.?????? 3,3,3,2
            ?????????#? 5,2
            #.????#.????##?.#? 1,2,2,6,2
            ??#?#.?.#? 3,1
            ??#??????#??.?? 3,3
            ..???..???? 1,1
            ???.##?.???? 2,3,1,2
            ??????#?#?.### 7,3
            ?????..??????.#??#? 3,1,1,1,2,1
            ?#?#??..????#??. 3,5
            #.?.#????#?? 1,2,2
            .???#...?# 2,1
            .???.???#???????.?? 1,1,1,5,1,1
            ??#??#???#?..? 5,3
            #??????##?? 3,5
            #??#.?#???####??#??? 1,2,2,1,5,2
            ???#?????.?????????# 5,1,1,1,1,1
            ?#?????#??? 1,1,2
            ???#?#?.??#???? 2,4,6
            #?????.?????? 1,4,1,2
            ???#???#?????.?? 11,1,1
            ##??????????#.? 3,1,5
            #.???????#???.???. 1,1,2,1,4,1
            ?#???..###? 2,3
            ?#?.??????? 2,1,1
            ???.?#?#?? 2,2,3
            ??#?##??..#? 1,4,1,2
            ?#####.????????#? 5,9
            ?.??.?####????? 1,1,8
            ???..#????????##. 1,11
            ?.??????????#????#? 11,4
            .?#???#?????##?. 2,2,1,2
            .???????.# 1,2,1
            .???#????#???#? 3,9
            ..?.??.##??#. 1,5
            ??.#???##?##?????# 1,1,13
            ?##???.???? 5,3
            ??.#?????.??? 1,2,1,1
            ?.?#?#???#.???#??#. 1,4,1,1,1,1
            #?.????#?..#??? 2,1,3,1,1
            ??#??##??? 4,4
            .????.?.??## 3,4
            ?.?????.?#???? 1,4,2,3
            .??????????. 2,1,1,1
            ?#?????..#?##? 1,1,1,3
            ???.?????..#? 1,1,1,2
            ????#??????.#?#.? 1,2,4,1,1
            ??#?.?#???#?#??#?? 1,1,2,4,1
            ??????????#?# 6,5
            ????#?#?#? 2,5
            .##??.#?????.#? 2,1,1,3,2
            #????.???#? 5,1
            ?????##????#.??#?# 4,2,5
            .?????#????# 2,1,3
            .??.#?????? 3,2
            ????##???.?.???? 5,1,1,1,1
            .?##?????#?. 2,4
            ?.????.??#???.?. 4,4,1
            ??##??#??..?? 5,1
            ?#???#?#?.?.#??#?? 1,6,1,2
            ???????#????#.?# 9,1
            #??.??#?#??. 3,7
            ##??????#.?# 2,4,1,1
            #??#?#??#???#??#. 6,7,1
            ??????????.? 2,2,2
            ??#???.???#?#?#???? 2,1,4,1,2,1
            ..?.#.#??.?# 1,1,1,1
            .###?#.###.? 5,3,1
            ????###?#??.#. 1,6,1
            ?.?#?#??##?????##?# 1,4,11
            .??????#?????.# 1,1,5,1,1
            .???????##??#.??. 12,1
            ??????????? 3,1
            ..???#?##?#?#??? 2,2,5
            ?????.???? 1,2,1
            ???#??##???.???#? 11,1,2
            ??????#??? 1,3
            ??#?????#? 4,1
            .?#???.?#?##??? 4,2,5
            ?#????#????.?#?#?#?? 1,3,1,2,1,3
            ?....?#????#??????.? 4,4
            ?#?#.????????##?? 2,1,5,2
            .???#??..?? 4,1
            ????#??.????#? 2,3,1,3
            ???####?.?#???##? 5,1,2
            ??#.#???????? 2,1,1,1
            .?#???.???.??#?? 2,1,3,2
            ???#?#???####???? 4,1,9
            ??..?????###????#?. 1,11
            ..???????#?#???..?#. 13,2
            .?#?##?????????.??? 5,4,1,1,1
            ?????.???.#????????? 3,1,3,4,2,1
            ?????????#???#? 1,5,4
            ??#???##.?. 3,3
            ????#.???#?##?#?.?.. 1,1,1,1,8,1
            ??#??#?##????#???.?? 12,2
            ??#????#??# 7,1
            ?.?#????????? 1,4
            ????#...?????#?? 4,2,2
            ???#????..?#? 6,2
            ???.?#?##??????????? 3,5,3,4
            ?##???#??..?#.#?? 2,1,3,2,2
            ?##??????.#. 9,1
            .?#????###.???? 8,1
            ???#?###????.? 4,3,1,1
            ?.????#???????????? 1,1,1,2,6,1
            ??##.??.?#.??#???#?? 4,2,1,2,3
            ???#??#?.?.?#??##?? 6,7
            ??#???##??#.?.?.?.#? 8,1,1,1,1,1
            .#?????#?? 1,6
            ?#?.??.#?? 2,1,3
            .??#?#?????#..#??. 1,1,1,5,3
            ?#.???.????#??. 2,1,3,1
            ..#?????.?.?# 4,1,1
            ??#??????#??#??? 3,7,1
            ?????????????##? 3,8
            ?.???#??????#.#??. 1,3,4,3
            ?#.#????#????? 2,4,5
            ????????????.? 2,1,3,2
            .???#??#??.? 3,3
            ?????.??#?? 2,1
            ?????????????#???? 2,11
            ?.??#??#?.?.????? 5,1,1,2
            ?##?..#???????.? 2,1,2,1,1
            ??????..???.? 4,3
            .#???#?#?##??????? 1,1,7,2,1
            ??##?????#?.???#. 6,4,2,1
            ??????.?..#????#? 1,4,1,1,5
            ?##.????#??. 2,5
            .??????#.?. 1,3,1
            ?.##?????..? 1,4,1
            ?????????#? 1,2,1
            ???.??#??? 1,1,2
            ????????#.? 8,1
            .????#???..#?? 6,2
            ??????.#?.?.?#?? 1,2,1,3
            ???#?#??.?????????. 6,7
            ???###?..??#???? 3,6
            ...???#?????.?#?. 8,2
            ?#?.???#?.?.? 2,3,1,1
            #?#?#????.#???? 6,2,2,1
            ?#?????##?.??#?#?.?? 9,1,1,1,1
            ??????????#?#? 1,1,1,3
            #????.??.?#??. 5,1,2
            ???..#??????### 1,1,1,2,3
            ???#.#?##??##?##? 3,1,3,6
            ???????..?? 4,2
            ?#???..#??#? 1,1,1,1
            ?..?#?#.?.#??#?? 2,1,1,3
            #??#?????#????.?? 4,3,2,1
            ??#?????.?#.? 5,1,1
            .?#??.#???#?????#?? 4,1,1,1,1,1
            ?????????#? 2,4
            ..?.?#??#?#??.??? 9,1
            .??.??##?. 1,5
            ..??#????.?..??? 6,1
            ?#????.????#? 4,1,1,3
            ?#??.??#?#????# 2,1,8
            ?#.?.#.#??#??#?#?## 1,1,1,12
            .??#???????. 2,2,2
            ??.##?.??#? 1,2,4
            ???????### 1,1,5
            .?.?##????? 4,1
            ??.#??.?#..#.?????? 1,2,2,1,2,1
            ?#?#??????#?##?? 8,1,2,1
            ??#?.??.#. 3,1
            ?#???#?.?.??.?#..?#? 7,1,1,1,2
            .?????.##.. 2,2
            ??.?????.??.#?#??. 1,3
            ?#?.#??#?..?? 2,4,1
            ??##?#??#?#?. 5,3
            ???#....????. 4,3
            #?.#????#?#?#?# 1,1,3,1,1
            #.#??#?.#.?????## 1,1,1,1,7
            ?.??????#??#???#?#? 1,1,1,12
            ?.?.????#???. 1,3,4
            .?..??##??..??.??? 1,6,2,1
            ?#????????#??? 3,2,4,1
            ??.????#?###??? 2,7
            ..?#?????#? 2,1
            ?..??????.#?..? 1,6,2
            ?.#.?.????? 1,1,3
            ???#???????????#?#?? 2,3,7,1,2
            ?##??#????##?..#???. 12,1,1
            ?????????.#?????. 5,2,1,1,1
            ??#?#?.??##?#??? 3,1,3,1,1
            ???#?????????. 3,5
            ?#?#?##????.?#?? 8,1,1
            ?.???#?.?.? 5,1
            ???.#.?#????????.. 1,1,9
            #?.???..?????#?.# 1,3,2,2,1
            ??##?.?.???##???? 3,6
            ??#??#???? 2,2
            #????#?#.. 4,3
            ?#???????????? 2,5
            #??????...??#??#???? 1,2,2,1,2,5
            .?#?#.????#.??.? 3,1,2,1
            ??#?#??.?#????? 5,1,1
            ????????.?#? 1,1,1,1
            ???????#?##?#?????#. 1,1,9,1
            ?##?.?????? 2,3
            ??##???#????#?.?# 11,1,1
            ??##?#?##?????#?? 8,4
            ##??#????#?#.?? 2,1,1,1,1
            #????????#????#??.? 4,5,2,1
            ???#???##???#?.?? 2,6
            ?#?.??#?????...#?. 2,7,2
            ????..?###????#?? 2,4,2
            ??#??????#??. 2,2,1,1
            ????#.?.#?.#????? 1,2,2,2,1
            .#????#???# 3,5
            .#?##???#??#?.# 9,2,1
            ????##??.#.? 4,1
            #.?????####??.?.???. 1,11,1,1
            ?#??????#? 2,1,2
            ??#?.?..?? 2,1
            ??.#??.?.? 1,1,1
            ?##??#.?#? 4,1,1
            ?#?######.?.## 8,1,2
            ?..#??#.?#?#?.#?? 1,1,1,4,1
            ????#??.??##?????#?? 1,5,8
            ??.???????? 2,1,2
            ???##?????????#.?#?? 7,7,1,1
            .?.?????#???. 3,1,2
            ?#?????????????#### 1,1,1,1,2,4
            ??#?.????### 3,2,3
            ?##?.????##???? 3,4,1
            #????????? 2,3
            ?.??#???.??##? 1,5,1,2
            ???##???###??.??.? 1,10,1
            ???#?????? 2,4
            .##????????? 4,2
            .?.????#?#? 2,4
            ???.???#???????#???? 1,11
            .?#??.??##? 1,3
            ????.??????????#..? 2,7
            ??#?.#??.?#???##??#? 1,1,1,8,2
            ?#?.????.?#??? 2,2,2
            ????????????????.?#? 5,1,1,2
            #?#.?.???????#?#??? 1,1,1,10
            .?#??#.?????###?? 3,1,1,5
            ?.?#?????#?#???? 1,2,1,5,1
            ??#???.###??..??.? 3,5,2
            ?##?#????.????#??#?? 7,8
            ?.?..????#????? 1,1,1,1,3
            ??#?##?...???#????? 5,4,1
            ????##???##?. 1,8
            ??.?#?#?.?.????? 1,5,3,1
            ?????.????..??. 2,2,1
            .??.??????? 1,2,3
            ..#?#??????#???? 11,1
            ?..?.???#??.?#??. 6,2
            ????.#?????????#???? 2,1,11,1
            ??#????????.??.?.?? 1,7,1,1,1,1
            ???????????.? 5,2
            ??????.?##?. 4,4
            .???.???#.? 1,3
            ??.?###????#??????#? 2,15
            ?#????##?? 3,3
            ??.????????????#? 2,2,1,1,2
            ?.?#.????.?. 2,4
            ?.#???#??? 1,2,2
            ???.?.?#.. 3,1
            ?#???????????????? 4,1,1,1,2,1
            .???#?????##.? 3,2,2,1
            ??#?.##..#??? 1,1,2,3
            #?.?###????#?.?? 1,9,1
            ..#??##?##?? 1,2,3
            ???#???##.??#???? 8,5
            .???????#??????????? 2,1,3,1,5
            ?#?#???#.??#?????#?? 3,1,2,5
            ?????????#??#??#. 1,3,1,5,1
            ??.#??###?.?.?. 1,7,1
            ?##????..?.??.. 6,1
            #???#?#??????#??.? 7,1,1,3
            ?.????#??#???.??.?# 10,2
            ??.?#?????#?##??.? 2,13
            ?#??#???#?#?#.?????? 12,2
            ?#??#????????? 3,6,1
            ??????????#?#?##?## 2,1,11
            .?#.???????#?#???? 2,11
            ..?#????##??.. 4,3
            ???????#????? 1,1,4,1
            ???#..#?#?? 1,1,5
            .?..?.#???? 1,4
            ????#???#?????#?? 6,1,3,1,1
            ??..?.???.?? 1,1
            ?#???.#??#????.? 2,1,1,2,1
            ?#?..##??#?? 2,5
            ????.??##?#??.? 1,5
            ??????.#?###.?? 1,1,1,3,1
            ?##??.?#?????? 5,2,4
            ????????????????.? 2,1
            ?#???#?????#???#?# 3,2,3,3
            .????#???.??.# 1,3,1,1
            ???????????? 5,1
            .?.#???????? 2,1,2
            ??#???.??????#?. 3,1,1,6
            ??.?#???.##??#?# 1,3,7
            ?..???#??#?????. 7,2
            ???.?.????#??#. 3,1,5
            ?.????##??##.?.??#?? 1,1,3,3,1,3
            ?????#???.#??#?#? 3,1,2,2,4
            #.???????.???#??? 1,1,1,1,2
            #?#?.????.?? 1,2,2,2
            #????.?#.#?.??.? 5,1,2,1,1
            ?#??.???#?#.#?.?? 2,6,1,1
            ??????#??.?.#?. 1,1,3,1,2
            ??.?...#??. 1,1,2
            .#?.?.??.?.??#.???? 1,1,1,1,2,3
            .#..??##?.? 1,4,1
            ???#????#?#.??. 1,3,1,1,1
            ??#??.?#??? 4,1
            ?.??##??.??. 5,1
            ??#???..??????? 3,1,1
            #.???##????#?? 1,4,4
            .#??#?#??.?#???? 2,4,6
            ????????##????? 2,2,7
            ?????#?#.??? 1,1,3,1
            ??.#????##?#???..#?. 1,11,1
            ???#?#???????????? 3,9
            ?#.#??#?.?#??? 2,1,1,5
            ??.??.???? 2,2
            ?????#?#??##? 8,3
            ?????.????#?#???? 2,1,6
            ?.???#?????.???? 1,1,7,1,1
            .?.????####??#??? 1,1,1,7,1
            ???.???.????? 2,1
            ????.????? 2,4
            ??#?..????.. 2,1
            ?#?#.?##?. 1,1,4
            ..######????????#?? 6,6
            ?#.???###?????? 2,8,1
            ?#????##?.???#???? 8,1,4
            ??????.?.#????#?#? 5,1,8
            ????#?#????.#???.? 1,1,2,1,3,1
            .?????#?#???..?? 5,1
            ?????##??????##?##. 6,10
            ????#???#???#??# 5,1,5,1
            ??????#?????#?#?.?? 13,1
            ??#???#?????? 4,1,1,1
            ?.?.?????#??#?? 1,5,2,1
            ?#.???.??.?#??.?. 1,1,1,2,1
            ?????##????? 6,1,1
            ?.##??#####??.???? 1,11,1,1
            ????#?????. 3,2
            ??????#.??#??? 2,1,3
            #?.?.???.??##???# 2,3,4,1
            .????#.??#???..????? 5,4,3
            .????.?.#????..?? 2,1,2,1,2
            ?..??#...#?##.? 3,4
            #.?????#.?.???#??#. 1,5,1,7
            .?#??##???? 5,1
            ?.?????#??#? 1,3,1,2
            ??#???.??.?#???? 2,1,1
            .?#?.?.?##?????# 1,1,5,1
            ??#.???.?###??? 2,2,6
            ????????.???? 1,2,1,2
            #?????.?.?#???. 1,4,4
            ?.??.?#???# 1,1
            ..????????#???????? 10,3
            ??#???.?.???. 2,1,1,1
            ??#?#???#?????? 10,1
            ??#?#??#??????. 5,7
            ??#??????? 2,1,2
            ?????##?????.. 1,4
            .?#??.??.#?#?#. 3,1,3,1
            ?.?????..? 1,1,1
            .????.??#?.?###???? 2,1,2,6
            .##???.??.###?????# 3,1,1,4,1,1
            ?..?#??##???#?#??? 3,10
            ??????##?#??#?? 4,9
            ?####?.????###?????? 5,8,1,1
            ?????????? 1,1,1
            ??.?????.??#??????# 1,1,1,2,1,3
            #?.##??.##. 1,3,2
            ????.?#?????# 1,1,1,3
            ??.?#.#??..##???. 2,1,2,5
            ??????????.?#??#???# 1,1,1,1,6,1
            ???#???#?#??#???. 9,2,1
            ?#???????????? 8,1,1
            #?.?.????????#??###? 1,1,12
            #??##???#? 5,1,1
            ?????.?#??????. 1,1,4,1
            ??#.#?#?.#?.????## 1,1,2,1,6
            ?.?????.#. 1,1,1
            ?????#????#?#??.#? 1,1,8,1,1
            ??##?.??###?.??? 1,2,1,4,1
            ?????#???#??..???.? 2,8,1,1
            #.#.??.?.??.???#? 1,1,1,1,4
            ?????.#?.?.?? 1,1,1,1
            .??#??#?.##???###? 7,8
            ?????????##??###?.? 3,11,1
            ???#?.??#???.??.? 3,4,2,1
            ?#??#??#??..?..?? 9,1,1
            .#???????#????? 1,1,1,5,1
            ?????????..???????# 2,2,1,1,5
            ?##?.??#??? 3,5
            #??#??##?? 1,3,3
            .?.?.??????##?#???? 1,2,7,1
            ??#?????##?#??.??? 2,5,3,1
            ???.....#?.?? 1,2
            ?#?.#??#???? 1,6
            ??#.??#?#??#??? 2,4,3
            ?.#?#??#.???# 6,1,1
            .??????#???.#.??##.. 8,1,4
            ??.???#?.##???#? 1,1,2,7
            ????#??#????????# 5,6,1,1
            ??#?.?#.#???#?? 3,2,2,3
            .#.?#?##.#..?????? 1,1,2,1,1,3
            ??##.??...??. 4,1,1
            #??#???.?#??? 2,1,1,5
            ?#???#?.?? 6,1
            #??.#???????.?.? 2,5,1,1
            ??#?#.???#??.?? 1,1,1,5,2
            ????#????.?. 1,7,1
            ?.?#.?.?#?. 2,2
            ..??..?????.?.##??? 1,5,3
            ?#?..#?##? 2,4
            ????..#????????#?#.? 3,12
            ???.??????#?????#?? 9,2
            ????????.# 3,1
            ??????#???#? 3,3,2
            ?#???#????.??# 3,4,1
            .?????????# 3,1,1
            ?.??#.??????#??? 1,1,1,5
            .???..?#.??? 3,1,1
            #?..??.?.??????# 1,2,1,2,2
            ?????????? 5,3
            ??#.??????#. 1,1,7
            ..???.?????? 2,1
            ?#????#?#???????#? 4,5,5
            ??????????#?####?##? 2,15
            ???.?????? 1,3
            ?#.####?#?#??#..# 2,4,4,1,1
            ????#???#.?.?.? 6,1,1,1
            ??#?#?????.. 3,2,1
            ####?????####.#????? 13,1,1
            ????#?????.??.#.?# 1,2,1,2,1,2
            #.?????#???. 1,2,3,1
            ???#????????.???#?# 10,5
            #???????##? 4,3
            ?#????.????..???#. 6,3,2
            ..#?##?.?.. 4,1
            ?#??.#?#??? 1,3,1
    """.trimIndent()
    )
    check(7857, result)
}

private fun test(input: String): Int {
    val lines = input.split("\n")
    val patterns = mutableListOf<Pair<String, List<Int>>>()
    for (line in lines) {
        val (pattern, token) = line.split(" ")
        val counts = token.split(",").map { it.toInt() }
        patterns += pattern to counts
    }

    fun isValid(s: String, counts: List<Int>): Boolean {
        val check = mutableListOf<Int>()
        var brokenCount = 0
        for (ch in s) {
            when (ch) {
                '.' -> {
                    if (brokenCount > 0) {
                        check += brokenCount
                    }
                    brokenCount = 0
                }

                '#' -> {
                    ++brokenCount
                }

                else -> {
                    throw IllegalStateException("illegal pattern $s")
                }
            }
        }
        if (brokenCount > 0) {
            check += brokenCount
        }
        return check == counts
    }

    fun permutations(
        result: CharArray, remainingA: Int, remainingB: Int, index: Int,
        variants: MutableList<String>
    ) {
        if (index == result.size) {
            variants += result.joinToString("")
            return
        }

        if (remainingA > 0) {
            result[index] = '.'
            permutations(result, remainingA - 1, remainingB, index + 1, variants)
        }

        if (remainingB > 0) {
            result[index] = '#'
            permutations(result, remainingA, remainingB - 1, index + 1, variants)
        }
    }

    fun permutations(n: Int, m: Int): List<String> {
        val result = CharArray(n + m)
        val variants = mutableListOf<String>()
        permutations(result, n, m, 0, variants)
        return variants
    }

    var sum = 0
    for (pattern in patterns) {
        val (s, counts) = pattern
        val operationalCount = s.count { it == '.' }
        val damagedCount = s.count { it == '#' }
        val supposedDamagedCount = counts.sum()
        val addDamaged = supposedDamagedCount - damagedCount
        val addOperational = s.length - operationalCount - damagedCount - addDamaged
        println("$s $counts dam $addDamaged op $addOperational")
        val chars = CharArray(addDamaged + addOperational)
        for (i in 1..addDamaged) chars[i - 1] = '#'
        for (j in addDamaged + 1..addDamaged + addOperational) chars[j - 1] = '.'
        val variants = permutations(addOperational, addDamaged)
        println("variants size ${variants.size}")
        var validCount = 0
        for (variant in variants) {
            var newString = ""
            var i = 0
            for (ch in s) {
                if (ch == '?') {
                    newString += variant[i]
                    ++i
                } else {
                    newString += ch
                }
            }
            if (isValid(newString, counts)) {
                ++validCount
            }
        }
        sum += validCount
        println("valid count $sum")
    }

    return sum
}
