package advent.advent2023

import utils.Point
import utils.plus

private var result = 0

fun main() {
    result = test(
        """
            #.#####################
            #.......#########...###
            #######.#########.#.###
            ###.....#.>.>.###.#.###
            ###v#####.#v#.###.#.###
            ###.>...#.#.#.....#...#
            ###v###.#.#.#########.#
            ###...#.#.#.......#...#
            #####.#.#.#######.#.###
            #.....#.#.#.......#...#
            #.#####.#.#.#########v#
            #.#...#...#...###...>.#
            #.#.#v#######v###.###v#
            #...#.>.#...>.>.#.###.#
            #####v#.#.###v#.#.###.#
            #.....#...#...#.#.#...#
            #.#########.###.#.#.###
            #...###...#...#...#.###
            ###.###.#.###v#####v###
            #...#...#.#.>.>.#.>.###
            #.###.###.#.###.#.#v###
            #.....###...###...#...#
            #####################.#
    """.trimIndent()
    )
    check(154, result)

    result = test(
        """
            #.###########################################################################################################################################
            #.#...#...#.........#...#...###...###...###...#...###...#.....###...........#.....#...........#...#...###...###...#...#...#.....#...#...#####
            #.#.#.#.#.#.#######.#.#.#.#.###.#.###.#.###.#.#.#.###.#.#.###.###.#########.#.###.#.#########.#.#.#.#.###.#.###.#.#.#.#.#.#.###.#.#.#.#.#####
            #.#.#.#.#.#.#.......#.#...#.#...#.....#.#...#.#.#...#.#.#.#...#...#.........#.#...#.........#...#.#.#.#...#.#...#.#.#.#.#.#...#.#.#...#.....#
            #.#.#v#.#.#.#.#######.#####.#.#########.#.###.#.###.#.#.#.#.###.###.#########.#.###########.#####.#.#.#.###.#.###.#.#.#.#.###.#.#.#########.#
            #.#.#.>.#...#...#...#.#.....#.........#.#...#.#.#...#.#.#.#.###...#.#.........#.#...###...#...#...#.#.#.#...#...#.#.#.#.#...#.#.#.#...#.....#
            #.#.#v#########.#.#.#.#.#############.#.###.#.#.#.###.#.#.#.#####.#.#.#########.#.#.###.#.###.#.###.#.#.#.#####.#.#.#.#.###.#.#.#.#.#.#.#####
            #...#...###.....#.#.#.#.#...#...#.....#.#...#...#.#...#...#...###.#.#.#.........#.#.#...#...#.#.###.#.#.#.#...#.#...#.#.#...#.#.#.#.#...#...#
            #######.###.#####.#.#.#.#.#.#.#.#.#####.#.#######.#.#########.###.#.#.#.#########.#.#.#####.#.#.###.#.#.#.#.#.#.#####.#.#.###.#.#.#.#####.#.#
            ###...#...#.....#.#.#.#.#.#.#.#.#...#...#.......#.#.....#.....#...#...#...#...#...#.#.#...#...#.#...#.#.#...#.#...#...#.#.#...#.#.#...###.#.#
            ###.#.###.#####.#.#.#.#.#.#.#.#.###.#.#########.#.#####.#.#####.#########.#.#.#.###.#.#.#.#####.#.###.#.#####.###.#.###.#.#.###.#.###.###.#.#
            #...#.....###...#.#.#.#.#.#...#.###.#.#...#...#.#.#...#.#.>.>...#.........#.#.#.#...#...#.....#...#...#.#.....###.#.###.#.#...#.#...#...#.#.#
            #.###########.###.#.#.#.#.#####.###.#.#.#.#.#.#.#.#.#.#.###v#####.#########.#.#.#.###########.#####.###.#.#######.#.###.#.###.#.###.###.#.#.#
            #.#...#.....#.###.#.#.#.#.#.....#...#...#.#.#.#.#.#.#...###.....#.......#...#...#.#...#...###.....#...#.#.#.>.>.#.#.#...#...#.#.#...#...#.#.#
            #.#.#.#.###.#.###.#.#.#.#.#.#####.#######.#.#.#.#.#.###########.#######.#.#######.#.#.#.#.#######.###.#.#.#.#v#.#.#.#.#####.#.#.#.###.###.#.#
            #...#.#.###.#...#.#.#.#.#.#.>.>...#.....#.#.#...#...#...........#.......#.......#...#.#.#...#.....###...#...#.#.#.#.#.###...#.#...#...#...#.#
            #####.#.###.###.#.#.#.#.#.###v#####.###.#.#.#########.###########.#############.#####.#.###.#.###############.#.#.#.#.###.###.#####.###.###.#
            #...#...#...###.#.#...#.#.#...#...#.#...#...#.......#...#...#####.....#...#...#.#.....#...#.#.........#.....#.#.#.#.#...#.....###...#...#...#
            #.#.#####.#####.#.#####.#.#.###.#.#.#.#######.#####.###.#.#.#########.#.#.#.#.#.#.#######.#.#########.#.###.#.#.#.#.###.#########.###.###.###
            #.#.......#...#...#...#...#...#.#.#.#.....#...#.....###...#...#.....#.#.#.#.#.#.#...>.>.#.#.....#.....#...#.#.#...#.....###...#...#...#...###
            #.#########.#.#####.#.#######.#.#.#.#####.#.###.#############.#.###.#.#.#.#.#.#.#####v#.#.#####.#.#######.#.#.#############.#.#.###.###.#####
            #...#.....#.#.......#.......#.#.#.#.###...#...#...#...#...#...#.#...#...#...#...#...#.#.#.....#.#...###...#.#.........#.....#...###.#...#...#
            ###.#.###.#.###############.#.#.#.#.###.#####.###.#.#.#.#.#.###.#.###############.#.#.#.#####.#.###.###.###.#########.#.###########.#.###.#.#
            #...#...#...#.......#.......#...#...#...#...#.#...#.#.#.#...#...#.......#.........#...#.#.....#.#...#...###...#.....#.#.............#.....#.#
            #.#####.#####.#####.#.###############.###.#.#.#.###.#.#.#####.#########.#.#############.#.#####.#.###.#######.#.###.#.#####################.#
            #...#...#.....#...#...#####...#.....#.....#...#.....#.#...#...#.........#.......###...#...#...#.#.###.....###.#...#.#.#.........#.......#...#
            ###.#.###.#####.#.#########.#.#.###.#################.###.#.###.###############.###.#.#####.#.#.#.#######.###.###.#.#.#.#######.#.#####.#.###
            #...#.#...#.....#.......###.#.#...#.###.....#...#.....###.#.#...#.....#.....###.#...#.......#.#.#.#.....#...#...#.#.#.#.......#.#.#...#...###
            #.###.#.###.###########.###.#.###.#.###v###.#.#.#.#######.#.#.###.###.#.###.###.#.###########.#.#.#.###.###.###.#.#.#.#######.#.#.#.#.#######
            #...#.#.....#...#...#...#...#...#.#...>.>.#...#...#...###...#.....#...#...#.#...#...#.........#.#.#...#...#...#.#.#...#.......#...#.#.......#
            ###.#.#######.#.#.#.#.###.#####.#.#####v#.#########.#.#############.#####.#.#.#####.#.#########.#.###.###.###.#.#.#####.###########.#######.#
            ###...#.......#...#...###.....#.#.#.....#.#...#.....#.....#.......#...#...#.#...#...#.#.......#...###...#.....#...#...#.............#.......#
            #######.#####################.#.#.#.#####.#.#.#.#########.#.#####.###.#.###.###v#.###.#.#####.#########.###########.#.###############.#######
            ###...#.......#...###...#...#.#...#...###...#.#.....#.....#.....#.....#...#.#.>.>.#...#.#.....###...#...#...#...###.#.###.............###...#
            ###.#.#######.#.#.###.#.#.#.#.#######.#######.#####.#.#########.#########.#.#.#v###.###.#.#######.#.#.###.#.#.#.###.#.###.###############.#.#
            #...#.#...###...#...#.#.#.#...#.......#.......#...#.#.#...#...#.....#.....#.#.#...#...#.#...#...#.#.#...#.#.#.#.#...#...#.......#...#...#.#.#
            #.###.#.#.#########.#.#.#.#####.#######.#######.#.#.#.#.#.#.#.#####v#.#####.#.###.###.#.###.#.#.#.#.###.#.#.#.#.#.#####.#######.#.#.#.#.#.#.#
            #...#...#...........#.#.#.....#.......#.#...#...#.#.#.#.#.#.#.#...>.>.#.....#.###...#...#...#.#.#.#.#...#.#.#.#.#.#.....#...#...#.#.#.#...#.#
            ###.#################.#.#####.#######.#.#.#.#.###.#.#.#.#.#.#.#.###v###.#####.#####.#####.###.#.#.#.#v###.#.#.#.#.#.#####.#.#v###.#.#.#####.#
            #...#...#.....#...#...#.#...#.#.......#.#.#.#.#...#.#...#...#...###.###.#.....#...#.....#.#...#.#.#.>.>...#.#.#.#.#.....#.#.>.###.#.#.#.....#
            #.###.#.#.###.#.#v#.###.#.#.#.#.#######.#.#.#.#.###.###############.###.#.#####.#.#####.#.#.###.#.###v#####.#.#.#.#####.#.###v###.#.#.#.#####
            #.....#...###...#.>.###...#...#.......#...#...#...#.....#.........#...#.#.#.....#.......#...#...#...#...###...#...#.....#.###...#.#.#.#.#...#
            #################v###################.###########.#####.#.#######.###.#.#.#.#################.#####.###.###########.#####.#####.#.#.#.#.#.#.#
            #...###...###...#.........#...........###...#.....#.....#.......#.#...#...#.....#.....#...###.....#.###.....###...#.....#...###.#.#...#...#.#
            #.#.###.#.###.#.#########.#.#############.#.#.#####.###########.#.#.###########.#.###.#.#.#######.#.#######.###.#.#####.###.###.#.#########.#
            #.#...#.#.#...#...........#.........#...#.#.#.#...#.....#.......#.#.....#.......#.#...#.#.....###...#.......#...#.....#.#...#...#.#.........#
            #.###.#.#.#.#######################.#.#.#.#.#.#.#.#####.#.#######.#####.#.#######.#.###.#####.#######.#######.#######.#.#.###.###.#.#########
            #...#...#...#...........###.........#.#.#.#.#...#...#...#.#.....#.#.....#.......#.#.....#.....#...###...#...#.#...#...#...###.....#.........#
            ###.#########.#########.###.#########.#.#.#.#######.#.###.#.###.#.#.###########.#.#######.#####.#.#####.#.#.#.#.#.#.#######################.#
            #...#...#.....#...#.....#...#...#.....#...#.......#.#.###...###.#...#...###...#...###...#.....#.#.#...#...#...#.#.#...#...#...#.....#.....#.#
            #.###.#.#.#####.#.#.#####.###.#.#.###############.#.#.#########.#####.#.###.#.#######.#.#####.#.#.#.#.#########.#.###.#.#.#.#.#.###.#.###.#.#
            #.....#...###...#.#.....#.....#...#...#...#.......#.#.#.........#...#.#.#...#.....#...#.#...#.#.#.#.#...#.......#.....#.#.#.#.#...#.#...#...#
            #############.###.#####.###########.#.#.#.#.#######.#.#.#########.#.#.#.#.#######.#.###.#.#.#.#.#.#.###.#.#############.#.#.#.###.#.###v#####
            #...#...###...###.#.....#...........#...#...#.....#...#...........#.#.#.#.#.......#...#...#...#.#...#...#...#...###.....#.#.#...#.#.#.>.#...#
            #.#.#.#.###.#####.#.#####.###################.###.#################.#.#.#.#.#########.#########.#####.#####.#.#.###.#####.#.###.#.#.#.#v#.#.#
            #.#.#.#.#...#...#...#...#.........#...###...#.#...###.............#.#.#.#.#.#...#...#.#...#...#.#.....#...#.#.#...#...###...###.#.#...#...#.#
            #.#.#.#.#v###.#.#####.#.#########.#.#.###.#.#.#.#####.###########.#.#.#.#.#.#.#.#.#.#v#.#.#.#.#.#.#####.#.#.#.###.###.#########.#.#########.#
            #.#.#.#.#.>.#.#.#.....#...#.......#.#.....#...#.#...#...........#...#.#...#.#.#.#.#.>.>.#...#.#.#.#...#.#.#...#...###.........#.#.#.........#
            #.#.#.#.#v#.#.#.#.#######.#.#######.###########.#.#.###########.#####.#####.#.#.#.###v#######.#.#.#.#.#.#.#####v#############.#.#.#.#########
            #.#...#...#...#.#...#.....#.....###.......#.....#.#...#...#...#.#...#.....#.#.#.#.#...#...###...#...#.#.#...#.>.>.#...#...#...#...#.........#
            #.#############.###.#.#########v#########.#.#####.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.###.#.###########.#.###.#.#v#.#.#.#.#.#.###############.#
            #...#.........#...#.#.......#.>.>.###.....#...#...#...#.#.#.#...#.#.#...#.#...#...#...#.#.......###...#...#...#.#.#.#...#...#.....#.....#...#
            ###.#.#######.###.#.#######.#.#v#.###.#######.#.###.###.#.#.#####.#.#.#.#.###########.#.#######.###.#####.#####.#.#.#########.###.#.###.#.###
            ###...#...#...###.#.....#...#.#.#...#.....#...#.#...###.#.#.....#.#.#.#.#.......#.....#.#.....#...#.......#.....#.#.....#...#...#...###...###
            #######.#.#.#####.#####.#.###.#.###.#####.#.###.#.#####.#.#####v#.#.#.#.#######.#.#####.#.###.###.#########.#####.#####.#.#.###.#############
            #.......#.#...#...#.....#.....#...#.#...#.#...#.#...#...#.#...>.>.#...#...#.....#.......#...#.#...###.....#.....#.....#.#.#...#.........#####
            #.#######.###.#.###.#############.#.#.#.#.###.#.###.#.###.#.###v#########.#.###############.#.#.#####.###.#####.#####.#.#.###.#########.#####
            #.....###...#.#...#...#...........#...#.#.#...#.###.#.#...#.#...#####...#...###...###.......#...#...#...#.......#...#...#...#.#...#...#.....#
            #####.#####.#.###.###.#.###############.#.#.###.###.#.#.###.#.#######.#.#######.#.###.###########.#.###.#########.#.#######.#.#.#.#.#.#####.#
            #####.....#...#...#...#.#.............#...#...#...#.#.#...#.#...###...#.....#...#...#.....#.....#.#...#.#.......#.#.....#...#...#...#.......#
            #########.#####.###.###.#.###########.#######.###.#.#.###.#.###.###.#######.#.#####.#####.#.###.#.###.#.#.#####.#.#####.#.###################
            #.........#...#.....###...#...#.......#...#...#...#...###...###.#...#.......#.....#.#.....#.#...#...#...#.#.....#.#.....#...............#...#
            #.#########.#.#############.#.#.#######.#.#.###.###############.#.###.###########.#.#.#####.#.#####.#####.#.#####.#.###################.#.#.#
            #.........#.#...#...........#.#.......#.#.#.....#...###...#.....#...#.#...#...###.#.#.....#.#.....#.#...#.#.....#.#.....#.....#.......#.#.#.#
            #########.#.###.#.###########.#######.#.#.#######.#.###.#.#.#######.#.#.#.#.#.###.#.#####v#.#####.#.#.#.#.#####.#.#####.#.###.#.#####.#.#.#.#
            #.........#.#...#.......#...#.........#.#.#.....#.#...#.#.#.....#...#.#.#.#.#.#...#.#...>.>.#.....#...#...#.....#.#.....#...#.#.....#.#...#.#
            #.#########.#.#########.#.#.###########.#.#.###.#.###.#.#.#####.#.###.#.#.#.#.#.###.#.###v###.#############.#####.#.#######.#.#####v#.#####.#
            #.........#.#.#.....###...#.#...#.....#.#...#...#.#...#.#.#.....#.###...#...#.#...#...###.#...#...#.....#...###...#.#.....#.#...#.>.#.#.....#
            #########.#.#.#.###.#######.#.#.#.###.#.#####.###.#.###.#.#.#####.###########.###.#######.#.###.#.#.###.#.#####.###.#.###.#.###.#.#v#.#.#####
            #.........#.#.#.#...#...###...#...#...#.....#...#.#.#...#.#.....#.....###...#.#...#.......#...#.#.#...#.#...#...#...#.###.#.###.#.#.#...#...#
            #.#########.#.#.#.###.#.###########.#######.###.#.#.#.###.#####.#####.###.#.#.#.###.#########.#.#.###.#.###v#.###.###.###.#.###.#.#.#####.#.#
            #.....#.....#.#.#.#...#.#.....#.....###...#.#...#.#.#.#...#...#.#...#...#.#...#.###.#...#####.#.#.#...#.#.>.>.###...#...#.#...#...#...###.#.#
            #####.#.#####.#.#.#.###.#.###.#.#######.#.#.#.###.#.#.#.###.#.#v#.#.###.#.#####.###.#.#.#####.#.#.#.###.#.#v#######.###.#.###.#######.###.#.#
            #...#.#...#...#.#.#.#...#...#.#.#.....#.#.#.#.#...#.#.#.#...#.>.>.#...#.#.....#...#...#.....#...#.#.###...#.....#...#...#...#.#...###...#.#.#
            #.#.#.###.#.###.#.#.#.#####.#.#v#.###.#.#.#.#.#.###.#.#.#.#####v#####.#.#####.###.#########.#####.#.###########.#.###.#####.#.#.#.#####.#.#.#
            #.#...#...#...#.#.#.#...#...#.>.>.###...#...#.#.#...#.#.#.....#...###...#.....#...#.........#...#...#...........#...#...###...#.#.#...#...#.#
            #.#####.#####.#.#.#.###.#.#####v#############.#.#.###.#.#####.###.#######.#####.###.#########.#.#####.#############.###.#######.#.#.#.#####.#
            #.....#...#...#.#.#.###.#...###...........#...#.#.#...#.......###.......#.......###.........#.#.#...#...........###...#.#.......#...#.......#
            #####v###.#.###.#.#.###.###.#############.#.###.#.#.###################.###################.#.#.#.#.###########.#####.#.#.###################
            #...#.>.#.#.#...#...#...#...#.............#.....#...#...................#.......###...#...#...#...#.###...#.....#...#...#...#...............#
            #.#.#v#.#.#.#.#######.###.###.#######################.###################.#####.###.#.#.#.#########.###.#.#.#####.#.#######.#.#############.#
            #.#...#...#...###...#.....###...#.........#...#.....#...................#.....#.#...#...#.....#...#.#...#...#...#.#.#...###.#.#.......#.....#
            #.###############.#.###########.#.#######.#.#.#.###.###################.#####.#.#.###########.#.#.#.#.#######.#.#.#.#.#.###.#.#.#####.#.#####
            #.#.......#.....#.#.......#.....#.###.....#.#.#...#.#...###...###...#...#.....#.#...#...#...#...#...#.........#...#...#...#...#.....#...#####
            #.#.#####.#.###.#.#######.#.#####.###.#####.#.###.#.#.#.###.#.###.#.#.###.#####.###.#.#.#.#.#############################.#########.#########
            #.#.#.....#.#...#...#.....#.....#.#...#...#.#...#.#.#.#.#...#.#...#...###...#...###...#...#.......#.....###...#.....#...#...#.....#.........#
            #.#.#.#####.#.#####.#.#########.#.#.###.#.#.###.#.#.#.#.#.###.#.###########.#.###################.#.###.###.#.#.###.#.#.###.#.###.#########.#
            #.#.#.....#.#.#.....#...#.......#.#...#.#.#...#.#.#.#.#.#...#.#...###...#...#.#...#.........#...#.#...#.....#.#.###...#.....#...#...........#
            #.#.#####.#.#.#.#######.#.#######.###.#.#.###.#.#.#.#.#.###.#.###v###.#.#.###.#.#.#.#######.#.#.#.###.#######.#.###############.#############
            #...#...#.#.#.#.#.......#...#.....###...#.#...#...#.#.#...#.#...>.>.#.#.#.#...#.#.#.....###...#...###...#...#...#...#.....#...#.............#
            #####.#.#.#.#.#.#.#########.#.###########.#.#######.#.###.#.#####v#.#.#.#.#.###.#.#####.###############.#.#.#####.#.#.###.#.#.#############.#
            #.....#...#.#...#.........#...###...#.....#.......#.#.###...#.....#.#.#.#.#...#.#.....#.......#...#...#...#...#...#.#.#...#.#.#.....###.....#
            #.#########.#############.#######.#.#.###########.#.#.#######.#####.#.#.#.###.#.#####.#######.#.#.#.#.#######.#.###.#.#.###.#.#.###.###.#####
            #...#.....#.......#.......#.......#...#...#.....#.#.#.#.......#...#...#.#.###...#.....#.......#.#.#.#...#.....#...#...#.....#.#...#.....#...#
            ###.#.###.#######.#v#######.###########.#.#.###.#.#.#.#.#######.#.#####.#.#######.#####.#######.#.#.###.#.#######.###########.###.#######.#.#
            #...#.###...#.....#.>.#...#...........#.#...###.#.#.#.#...#.....#...#...#.......#...#...###...#.#.#.#...#...#...#.#...#.......###.........#.#
            #.###.#####.#.#####v#.#.#.###########.#.#######.#.#.#.###.#.#######.#.#########.###.#.#####.#.#.#.#.#.#####.#.#.#.#.#.#.###################.#
            #...#...#...#.###...#...#...#.........#.......#...#...#...#.#.......#...#.....#.#...#...###.#.#.#.#.#.#...#.#.#.#...#.#.#.....#.....#.....#.#
            ###.###.#.###.###.#########.#.###############.#########.###.#.#########.#.###.#.#.#####.###.#.#.#.#.#.#.#.#v#.#.#####.#.#.###.#.###.#.###.#.#
            #...#...#.....#...###.......#.........#.....#...#.....#.....#.........#.#...#.#.#.....#.#...#.#.#.#.#.#.#.>.>.#.#...#.#.#...#.#...#.#...#...#
            #.###.#########.#####.###############v#.###.###.#.###.###############.#.###.#.#.#####.#v#.###.#.#.#.#.#.###v###.#.#.#.#.###.#.###.#.###v#####
            #.#...#####.....#...#...#.....#...#.>.>.###.....#.#...#...............#.....#...#####.>.>.###.#.#.#.#.#.###...#.#.#.#.#...#.#.#...#.#.>.#...#
            #.#.#######.#####.#.###.#.###.#.#.#.#v###########.#.###.###############################v#####.#.#.#.#.#.#####.#.#.#.#.###.#.#.#.###.#.#v#.#.#
            #...#...#...#.....#.#...#.###.#.#.#.#.............#...#.....#...#.......#...#...###...#...###...#.#.#.#.#...#.#.#.#.#...#.#.#.#.###...#...#.#
            #####.#.#.###.#####.#.###.###.#.#.#.#################.#####.#.#.#.#####.#.#.#.#.###.#.###.#######.#.#.#.#.#.#.#.#.#.###.#.#.#.#.###########.#
            #...#.#.#.....#.....#...#.###...#...#...#...#...#...#.#.....#.#...#.....#.#.#.#.....#...#.......#.#.#...#.#...#...#.....#.#.#.#.#...#.......#
            #.#.#.#.#######.#######.#.###########.#.#.#.#.#.#.#.#.#.#####.#####.#####.#.#.#########.#######.#.#.#####.###############.#.#.#.#.#.#.#######
            #.#...#.###...#.......#.#...#.........#...#...#...#...#.......#.....#...#.#.#.....#...#.........#...#...#...............#.#.#...#.#.#.......#
            #.#####.###.#.#######.#.###.#.#################################.#####.#.#.#.#####.#.#.###############.#.###############.#.#.#####.#.#######.#
            #.#...#...#.#.........#...#.#...#...........###.....#...#.....#.......#...#.....#...#...........#...#.#.................#...#.....#.........#
            #.#.#.###.#.#############.#.###.#.#########.###.###.#.#.#.###.#################.###############.#.#.#.#######################.###############
            #...#.#...#.............#...#...#.#.......#...#.#...#.#.#...#.#.......#...#...#.#...............#.#.#...#.......#.....###...#.....#.........#
            #####.#.###############.#####.###.#.#####.###.#.#.###.#.###.#.#.#####.#.#.#.#.#.#.###############.#.###.#.#####.#.###.###.#.#####.#.#######.#
            #.....#...#...#...#...#...###.....#.....#.#...#.#...#.#.....#...#...#...#...#...#...............#.#.###...###...#...#...#.#.#...#...#.......#
            #.#######.#.#.#.#.#.#.###.#############.#.#.###.###.#.###########.#.###########################.#.#.#########.#####.###.#.#.#.#.#####v#######
            #...#...#...#...#.#.#.....#...#.........#.#.###.#...#.............#.....###...#...#.............#.#.#...#.....#...#...#...#.#.#.#...>.#...###
            ###.#.#.#########.#.#######.#.#.#########.#.###.#.#####################.###.#.#.#.#.#############.#.#.#.#.#####.#.###.#####.#.#.#.###v#.#.###
            #...#.#.#.......#...#...#...#...#.....###...#...#...#...........###...#.#...#...#.#.....#.....###.#.#.#.#.....#.#.#...#.....#.#.#.#...#.#.###
            #.###.#.#.#####.#####.#.#.#######.###.#######.#####.#.#########.###.#.#.#.#######.#####.#.###.###.#.#.#.#####.#.#.#.###.#####.#.#.#.###.#.###
            #.#...#...#...#.......#.#.........###...#...#.#.....#.........#.....#...#.......#.......#.#...#...#.#.#.#...#.#.#.#...#.#...#.#.#.#.#...#...#
            #.#.#######.#.#########.###############.#.#.#.#.#############.#################.#########.#.###.###.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#####.#
            #.#.#.......#...........#.......#.......#.#...#.#...#...#...#.........###...###.......#...#.#...#...#.#.#.#.#.#.#.#...#...#.#.#...#.#.#.....#
            #.#.#.###################.#####.#.#######.#####.#.#.#.#.#.#.#########.###.#.#########.#.###.#.###.###.#.#.#.#v#.#.#.#######.#.#####.#.#.#####
            #...#.............#...#...#.....#.....###...#...#.#.#.#.#.#.#...###...#...#.#.....#...#.#...#...#.#...#.#.#.>.>.#.#.....#...#.....#.#.#.#...#
            #################.#.#.#.###.#########.#####.#.###.#.#.#.#.#.#.#.###v###.###.#.###.#.###.#.#####.#.#.###.#.#######.#####.#.#######.#.#.#.#.#.#
            #.................#.#.#.#...###...###.#...#.#.#...#.#.#.#.#.#.#.#.>.>.#.#...#...#.#...#.#.#...#.#.#...#.#.###...#...#...#...#.....#...#...#.#
            #.#################.#.#.#.#####.#.###v#.#.#.#.#.###.#.#.#.#.#.#.#.###.#.#.#####.#.###v#.#.#.#.#.#.###.#.#.###.#.###.#.#####.#.#############.#
            #...#.....#...#...#.#.#.#...#...#.#.>.>.#.#.#.#...#.#.#.#.#.#.#.#.###.#.#.#...#.#.#.>.>.#.#.#.#.#.#...#.#.....#.#...#.#.....#...#...........#
            ###.#.###.#.#.#.#.#.#.#.###.#.###.#.#####.#.#.###.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.###.#######.#.###.#.#######.#.###########
            ###...###...#...#...#...###...###...#####...#.....#...#...#...#...###...#...#...#...#####...#...#...###.........#.....#.........#...........#
            ###########################################################################################################################################.#
    """.trimIndent()
    )
    check(6302, result)
}

private fun test(input: String): Int {
    val map = input.split("\n")
    val width = map[0].length
    val height = map.size
    val cols = 0 until width
    val rows = 0 until height
    val startPoint = Point(1, 0)
    val endPoint = Point(width - 2, height - 1)
    fun value(p: Point) = map[p.y][p.x]

    val permitted = setOf('.', '>', 'v')
    fun Point.check(previous: List<Point>) = x in cols && y in rows
            && value(this) in permitted
            && this !in previous

    val points = listOf(Point(-1, 0), Point(0, -1), Point(1, 0), Point(0, 1))
    fun Point.next(previous: List<Point>): List<Point> {
        val result = mutableListOf<Point>()
        for (p in points) {
            val newP = plus(p)
            if (newP.check(previous)) {
                result += newP
            }
        }
        return result
    }

    data class Edge(val from: Point, val to: Point, val size: Int)

    val edges = mutableMapOf<Point, MutableSet<Edge>>()
    fun putNewEdgeAtomic(currentEdge: List<Point>) {
        edges.putIfAbsent(currentEdge[0], mutableSetOf())
        edges[currentEdge[0]]!! += Edge(currentEdge.first(), currentEdge.last(), currentEdge.size - 1)
    }

    fun putNewEdge(currentEdge: List<Point>) {
        putNewEdgeAtomic(currentEdge)
        putNewEdgeAtomic(currentEdge.reversed())
    }

    fun findEdges(currentEdge: MutableList<Point>, closed: MutableSet<Point>) {
        var next = currentEdge.last().next(currentEdge)
        while (next.size == 1) {
            currentEdge += next.first()
            next = currentEdge.last().next(currentEdge)
        }
        if (next.isEmpty()) {
            putNewEdge(currentEdge)
        } else {
            putNewEdge(currentEdge)
            if (currentEdge.last() !in closed) {
                closed += currentEdge.last()
                for (nextPoint in next) {
                    val newEdge = mutableListOf<Point>().apply {
                        this += currentEdge.last()
                        this += nextPoint
                    }
                    if (nextPoint == endPoint) {
                        putNewEdge(newEdge)
                    } else {
                        findEdges(newEdge, closed)
                    }
                }
            }
        }
    }

    findEdges(mutableListOf<Point>().apply { this += startPoint }, mutableSetOf<Point>().apply { this += startPoint })
    edges.forEach { println(it) }

    var max = 0
    fun dfs(currentPath: List<Edge>) {
        if (currentPath.last().to == endPoint) {
            val length = currentPath.map { it.size }.sum()
            if (length > max) {
                max = length
                println("path ${currentPath.size} edges long")
                println("current max is $max")
            }
        } else {
            val next = edges[currentPath.last().to] ?: emptyList()
            for (nextEdge in next) {
                if (currentPath.any { it.from == nextEdge.to || it.to == nextEdge.to }) continue
                dfs(mutableListOf<Edge>().apply { this += currentPath; this += nextEdge })
            }
        }
    }

    val currentPath = listOf(edges[startPoint]!!.first())
    dfs(currentPath)
    return max
}
