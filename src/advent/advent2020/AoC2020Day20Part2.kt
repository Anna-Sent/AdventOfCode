package advent.advent2020

import kotlin.math.sqrt

private fun test(input: String): Int {
    val tiles = mutableSetOf<Tile2>()

    val tokens = input.split("\n\n")
    for (token in tokens) {
        val (tileName, tileInput) = token.split(":\n")
        val tileId = tileName.substring("Tile ".length, tileName.length).toLong()
        val tileRect = tileInput.split("\n").map { it.toCharArray() }
        tiles += tileRect.generate().map { Tile2(tileId, it) }
    }

    val squareSize = sqrt((tiles.size / 8).toDouble()).toInt()

    val solutions = findSolution(squareSize, tiles)
            .map { it.rect }
            .map { it.removeBorders() }
            .glue(squareSize)
            .generate()
    for (solution in solutions) {
        val countOfMonsters = solution.countOfMonsters()
        println("found $countOfMonsters")
        if (countOfMonsters > 0) {
            val symbolsCount = solution.sumBy { arr -> arr.count { it == '#' } }
            return symbolsCount - countOfMonsters * monsterSymbolsCount
        }
    }
    return -1
}

private val monster = listOf(
        "                  # ".toCharArray(),
        "#    ##    ##    ###".toCharArray(),
        " #  #  #  #  #  #   ".toCharArray()
)
private val monsterSymbolsCount = monster.sumBy { arr -> arr.count { it == '#' } }

private fun List<CharArray>.countOfMonsters(): Int {
    var count = 0
    for (i in 0..size - monster.size) {
        for (j in 0..this[i].size - monster[0].size) {
            var found = true
            for (ii in monster.indices) {
                for (jj in monster[ii].indices) {
                    if (this[i + ii][j + jj] != monster[ii][jj] && monster[ii][jj] == '#') {
                        found = false
                        break
                    }
                }
            }
            if (found) ++count
        }
    }
    return count
}

private fun List<List<CharArray>>.glue(squareSize: Int): List<CharArray> {
    val result = mutableListOf<CharArray>()
    for (i in 0 until squareSize * 8) {
        result += CharArray(squareSize * 8) {
            this[i / 8 * squareSize + it / 8][i % 8][it % 8]
        }
    }
    return result
}

private fun List<CharArray>.removeBorders(): List<CharArray> {
    val result = mutableListOf<CharArray>()
    for (i in 1 until lastIndex) {
        result += CharArray(size - 2) {
            this[i][it + 1]
        }
    }
    return result
}

private fun findSolution(squareSize: Int, tiles: Set<Tile2>): List<Tile2> {
    var solution: List<Tile2>? = null
    for (tile in tiles) {
        solution = bfs(listOf(tile), squareSize, tiles)
        if (solution != null) {
            break
        }
    }
    return solution!!
}

private fun bfs(initialState: List<Tile2>, squareSize: Int, tiles: Set<Tile2>): List<Tile2>? {
    val closed = mutableSetOf<List<Tile2>>()
    var opened = mutableSetOf<List<Tile2>>()

    opened.add(initialState)

    while (opened.size > 0) {
        val achievable = mutableSetOf<List<Tile2>>()
        for (current in opened) {
            if (current.size == squareSize * squareSize) {
                return current
            }
            val set = generateNext(current, squareSize, tiles)
            for (next in set) {
                if (!closed.contains(next)) {
                    achievable.add(next)
                }
            }
            closed.add(current)
        }
        opened = achievable
    }

    return null
}

private fun generateNext(current: List<Tile2>, squareSize: Int, tiles: Set<Tile2>): Set<List<Tile2>> {
    val result = mutableSetOf<List<Tile2>>()
    val details = tiles.filter { t -> current.count { it.id == t.id } == 0 }
    for (detail in details) {
        val list = mutableListOf<Tile2>()
        list += current
        list += detail
        if (isValid(squareSize, list)) {
            result += list
        }
    }
    return result
}

private fun isValid(squareSize: Int, list: List<Tile2>): Boolean {
    val index = list.lastIndex
    val i = index / squareSize
    val j = index % squareSize
    val tile = list[i * squareSize + j]
    if (i > 0) {
        // check up
        val up = tile.up
        val adjacent = list[(i - 1) * squareSize + j]
        val down = adjacent.down
        if (!up.contentEquals(down)) {
            return false
        }
    }
    if (j > 0) {
        // check left
        val left = tile.left
        val adjacent = list[i * squareSize + j - 1]
        val right = adjacent.right
        if (!left.contentEquals(right)) {
            return false
        }
    }
    return true
}

private fun List<CharArray>.generate(): Set<List<CharArray>> {
    val result = mutableSetOf<List<CharArray>>()

    var r = this
    for (i in 1..4) {
        result += r
        r = r.rotate()
    }
    r = r.flip()
    for (i in 1..4) {
        result += r
        r = r.rotate()
    }

    return result
}

private fun List<CharArray>.flip(): List<CharArray> {
    val result = mutableListOf<CharArray>()
    for (i in 0 until size) {
        result += this[i].reversedArray()
    }
    return result
}

private fun List<CharArray>.rotate(): List<CharArray> {
    val result = mutableListOf<CharArray>()
    for (i in 0 until size) {
        result += col(i).reversedArray()
    }
    return result
}

private fun List<CharArray>.col(j: Int): CharArray {
    return CharArray(size) { this[it][j] }
}

private data class Tile2(val id: Long,
                         val rect: List<CharArray>
) {
    val up = rect[0]
    val down = rect[rect.lastIndex]
    val left = rect.col(0)
    val right = rect.col(rect.lastIndex)
}

fun main() {
    test()
}

private var result: Int = 0

private fun test() {
    result = test("""
        Tile 2311:
        ..##.#..#.
        ##..#.....
        #...##..#.
        ####.#...#
        ##.##.###.
        ##...#.###
        .#.#.#..##
        ..#....#..
        ###...#.#.
        ..###..###

        Tile 1951:
        #.##...##.
        #.####...#
        .....#..##
        #...######
        .##.#....#
        .###.#####
        ###.##.##.
        .###....#.
        ..#.#..#.#
        #...##.#..

        Tile 1171:
        ####...##.
        #..##.#..#
        ##.#..#.#.
        .###.####.
        ..###.####
        .##....##.
        .#...####.
        #.##.####.
        ####..#...
        .....##...

        Tile 1427:
        ###.##.#..
        .#..#.##..
        .#.##.#..#
        #.#.#.##.#
        ....#...##
        ...##..##.
        ...#.#####
        .#.####.#.
        ..#..###.#
        ..##.#..#.

        Tile 1489:
        ##.#.#....
        ..##...#..
        .##..##...
        ..#...#...
        #####...#.
        #..#.#.#.#
        ...#.#.#..
        ##.#...##.
        ..##.##.##
        ###.##.#..

        Tile 2473:
        #....####.
        #..#.##...
        #.##..#...
        ######.#.#
        .#...#.#.#
        .#########
        .###.#..#.
        ########.#
        ##...##.#.
        ..###.#.#.

        Tile 2971:
        ..#.#....#
        #...###...
        #.#.###...
        ##.##..#..
        .#####..##
        .#..####.#
        #..#.#..#.
        ..####.###
        ..#.#.###.
        ...#.#.#.#

        Tile 2729:
        ...#.#.#.#
        ####.#....
        ..#.#.....
        ....#..#.#
        .##..##.#.
        .#.####...
        ####.#.#..
        ##.####...
        ##..#.##..
        #.##...##.

        Tile 3079:
        #.#.#####.
        .#..######
        ..#.......
        ######....
        ####.#..#.
        .#...#.##.
        #.#####.##
        ..#.###...
        ..#.......
        ..#.###...
    """.trimIndent())
    check(273, result)

    result = test("""
        Tile 3623:
        .##...#.#.
        ..##..#...
        #......#.#
        #.#..#.#..
        ##......#.
        ......#..#
        ###...#.#.
        #.#.#.#.#.
        ......####
        #####....#

        Tile 1301:
        .#..###..#
        .##..##..#
        #.......#.
        ###...###.
        ##.#..#.##
        .#.##.##..
        #.#####.##
        #..##.....
        #......#..
        ...#...#..

        Tile 3089:
        ######.##.
        .#...#..##
        #.#.##.#.#
        #....#....
        #.....#..#
        #.##..#..#
        .##..#..#.
        #.##...##.
        #..#.###..
        #.###.#..#

        Tile 3217:
        #.######..
        ...#.#...#
        .#.#..#...
        #.#.##...#
        #..#..#...
        ...#......
        ..#..#.###
        #.#...##..
        #...#..#..
        ..##.##..#

        Tile 3203:
        .##...#..#
        #...##...#
        #....#....
        #.###....#
        #.##......
        .....#.#..
        ....#....#
        #..#.....#
        #......#.#
        ##.#.###..

        Tile 3467:
        .#....#.#.
        ...###...#
        #...#.####
        ..###.#..#
        .....####.
        #...##.##.
        ##.#.#.#..
        ##....#..#
        ##......#.
        #####..###

        Tile 1013:
        #.....##..
        .#..#..###
        ##....#.#.
        #.#.##.#.#
        ###....#..
        #...#..#..
        #.##....#.
        ...#......
        .......#..
        .##.#..#..

        Tile 2843:
        .##.#...##
        #.###.#...
        #....##.#.
        #...###.#.
        .#..#.....
        .....##...
        ###.##..#.
        ...#..#...
        #.#....#..
        #.####..#.

        Tile 1549:
        ###...#...
        .#.##....#
        .......#..
        #.###...##
        ##..#..#..
        .#.#......
        #.####...#
        #.##....##
        #.......#.
        #.#.###.#.

        Tile 2591:
        ######.#.#
        .###.....#
        #..####.##
        #..#..#..#
        ...#.#.##.
        ...###....
        .#...#..#.
        .##....#..
        ...##....#
        ##...#....

        Tile 2897:
        ###..##.#.
        ...#..##..
        ..........
        .....#...#
        ....###..#
        ...#.#...#
        #..###.#..
        .....#...#
        #....#....
        ...#####..

        Tile 3433:
        ##...#....
        #.##.....#
        ..##...##.
        #..##...#.
        #..#.#..##
        #.#....#..
        ....##...#
        #..#......
        ###.#.....
        .#.#.#..##

        Tile 1153:
        #.#.##..##
        ##..###...
        #..#.....#
        ....#.#.##
        .#.#...#..
        #....#...#
        .#.....#..
        #..#..###.
        ..#.#.##.#
        ##...##...

        Tile 1223:
        .#..###.#.
        .....#.#..
        ....#....#
        ..#.......
        ##.###...#
        ..#.#.#..#
        .##.......
        .##......#
        #........#
        ......#...

        Tile 1579:
        .##.####.#
        ..........
        ..........
        .........#
        ##..#..#..
        #.##....#.
        ##...#....
        #..#.#...#
        ..##.#...#
        ###..#..#.

        Tile 2687:
        #..#.#....
        ##...#....
        #...#.##..
        .....#..#.
        #.........
        #...#....#
        #....#...#
        ..........
        ##.....###
        ###..#.###

        Tile 3881:
        ..##..###.
        ##.#...#.#
        ..#....#.#
        ##........
        #........#
        #........#
        #..#...###
        #.##.#.#..
        .....#..##
        ###...#.##

        Tile 3169:
        ...#.#####
        #.........
        .......##.
        .#..#.#...
        #.......#.
        ...##....#
        #.#.#.#..#
        ...#.#....
        #.......##
        .....##.##

        Tile 1973:
        ##..###...
        .#.#.##...
        #......#..
        #...#...##
        #..#.#..#.
        #.#.#..#.#
        .......##.
        .#.....#.#
        ...#..###.
        ##.#.#..#.

        Tile 3581:
        ####.###..
        ..#......#
        ..##.....#
        .#.####...
        ...#..#.#.
        ....#....#
        .#.....#..
        ###.#.#...
        #......###
        ##...#...#

        Tile 1723:
        ..####...#
        ##........
        ......#..#
        ...#...#.#
        #.##.#..##
        #.....##.#
        ..#......#
        ..........
        ...#.#...#
        #..#.##.#.

        Tile 2539:
        #.##.#..##
        #....#...#
        #.##..#.##
        ......##..
        .....#..##
        #....#...#
        ......#..#
        ###.###..#
        ......#...
        ..#.##..##

        Tile 2531:
        ....##.##.
        #..#.#..#.
        ....#....#
        ...##.#..#
        .##..#..#.
        .#....###.
        #.####.#.#
        ....#..#.#
        ###..##.##
        .#...##..#

        Tile 3917:
        #.#...#...
        #.#.......
        .#.##.#...
        .##...#...
        ..##.##.##
        #.....#...
        #...#...#.
        #.##.....#
        ..#..#..#.
        #..##....#

        Tile 1489:
        ..#..#.###
        #...#####.
        ....##...#
        .#.##.##.#
        .####....#
        ...#...###
        ..........
        #..##.#.#.
        ##..#.#.#.
        #.##...###

        Tile 1669:
        ##.##.###.
        ...#....##
        #.#.....##
        ..#....#.#
        .#.#...#..
        ####.##...
        #..###..#.
        #..##...##
        #.#.#.....
        ######.#.#

        Tile 2549:
        ###.#.....
        ......#.#.
        #.#...#..#
        #....##...
        ...#...#.#
        ##.......#
        ##...#...#
        ......#..#
        #.....#.##
        ..#.#...#.

        Tile 3797:
        .#####...#
        #..##.#..#
        ##.###.#..
        ##..##....
        ..####....
        ...#...#.#
        ##..#.##.#
        ....#....#
        .####.#...
        .....##.#.

        Tile 2137:
        #.#..#.###
        ..##....##
        ....##...#
        ##.#..#...
        .##.##.###
        ##...#.#.#
        #.....#.#.
        ..#..#...#
        ##..#.###.
        #...##.##.

        Tile 2087:
        #.#...##..
        ..###.....
        ##.#....#.
        #........#
        ..#.#..#.#
        .#..#...##
        .##......#
        ...#..#..#
        #.#..#....
        ######..##

        Tile 3929:
        ...##.#.#.
        ..#..#...#
        .#.###....
        .##.......
        ...##.#.##
        #...###.#.
        #.##.#....
        #.#....##.
        .........#
        .###.#####

        Tile 1907:
        #.###.#.#.
        #........#
        ##.#.##..#
        ...#...##.
        ##.#....#.
        .....#..#.
        .###...##.
        .#.......#
        .#...###..
        #..#.#.##.

        Tile 3923:
        ..#..##...
        ........#.
        #....###..
        .........#
        ...#.###..
        #...####.#
        ..##...#..
        .##......#
        #.....#...
        .#.....#.#

        Tile 2833:
        ###.#.##.#
        #..###...#
        ##..#.....
        #..##.#...
        ..#..#.#.#
        ..##.....#
        #........#
        #...#.#...
        ##..#...#.
        .#########

        Tile 2143:
        #.##.##..#
        #..#.##..#
        ..#....#.#
        ##.#.#...#
        ....#...#.
        #.........
        ##...#.##.
        #.##.###.#
        ....##...#
        #...##.#.#

        Tile 2039:
        #.##..##..
        ....##.#..
        #...#.##.#
        ##.#.#....
        .......#..
        #.##....##
        .#..##.#..
        ...##.....
        #...#....#
        ##....#.#.

        Tile 3943:
        #.#..#.#..
        ##..#...##
        ...#.#...#
        .###.#.##.
        ..#...#.##
        ....#..###
        #..#...#..
        #..#.##.##
        ##.###...#
        ##...#####

        Tile 1697:
        .#..#####.
        #....####.
        .#.#.....#
        .........#
        ..#......#
        .#.#.....#
        #..##.##..
        ##.#....#.
        .##..#....
        #.##.#####

        Tile 1621:
        ..#.###..#
        ...###..#.
        ..........
        #........#
        ##........
        #.##....#.
        #...#.....
        ....#.#..#
        #.........
        .###.###..

        Tile 2683:
        #..######.
        .#......#.
        ....#.#..#
        ##......#.
        ...#.....#
        ......#..#
        ##.......#
        .#...#.###
        ###.#....#
        ##.###.#.#

        Tile 2203:
        ##..##...#
        ..#..#...#
        ##...#....
        ##..##....
        #...###..#
        ...#..#.##
        #.....##.#
        ..#...#..#
        ###....#..
        ####.#..#.

        Tile 3469:
        ###...##.#
        #.#..#####
        ..#.#.#..#
        #..#......
        #...#....#
        ##....#..#
        #...##....
        .#.#.###..
        ..#..##.#.
        ..##.#.#.#

        Tile 1801:
        ..#....#.#
        #...#..#..
        .#..#....#
        ##..#.#.#.
        ##.###.#.#
        ..##..#...
        ##..##....
        ..#...####
        #.#.....#.
        .#.......#

        Tile 3373:
        #.#..#..#.
        ....##.#..
        #......###
        #....###.#
        ##.#.#####
        #..#...##.
        #.##....#.
        .##.....#.
        ......#...
        ##..##.##.

        Tile 2237:
        .###.#....
        ..#..##..#
        #.#.##.#..
        #.#.##..#.
        ...#..#..#
        #.##...#..
        ####...###
        #..#.....#
        ..#.....##
        ###..#..##

        Tile 2221:
        #.###.....
        ...##.....
        ..#.#.....
        #..##.....
        ......#.##
        .....#.#..
        .#.#.....#
        ....###...
        #....#.##.
        ##.#####.#

        Tile 2927:
        #.###...##
        ......##..
        .......###
        ##....##.#
        ..#...#...
        ..#...#.##
        #..#...#..
        .........#
        .#..#...##
        .####.#.#.

        Tile 1861:
        .#.#...#..
        ..#.......
        ##.....#..
        #....#....
        ##..#....#
        .##.#.##.#
        ....##..##
        ##.#....#.
        #.....###.
        #..#.....#

        Tile 1097:
        #......#.#
        #....##..#
        ###.#..###
        ...#......
        ..#....#.#
        #...#.....
        ##..##.#.#
        ###...##..
        #..##...##
        ..###....#

        Tile 3331:
        #..##.#..#
        #.###.##.#
        .#.##...#.
        ...#.##..#
        .........#
        ......##..
        #..#.....#
        ..#....###
        ...#.....#
        .##.#.##.#

        Tile 1033:
        #.##..#.##
        ..#.......
        ...#...#..
        ....##.###
        ##.####..#
        #.#.##.##.
        .#..#..#..
        .........#
        #.#.......
        ##.####..#

        Tile 1933:
        ..##....##
        #...#.##.#
        ##....####
        ......#.#.
        ......###.
        #...#..###
        #...#.....
        ......##..
        ......#..#
        #....###..

        Tile 1483:
        #.###....#
        #.###...##
        ..........
        ..#.#.#..#
        ........##
        ....#.....
        #.##.#...#
        ....##....
        ....#.##..
        ....#..#..

        Tile 3823:
        #.###.###.
        .##..#.##.
        #...#..#..
        #.##....#.
        ....#.....
        ###.####.#
        .#.##.#.##
        ...##..#..
        #..#.#..#.
        ..#.##..#.

        Tile 1759:
        #..##...#.
        .####..###
        #.#......#
        .##...#..#
        ##........
        ##......##
        #..##....#
        ..#...##..
        #......#.#
        ####.#..##

        Tile 1187:
        .##.#..###
        ....##....
        ##.#......
        #..##....#
        #.#.#.#.#.
        ..#.###...
        ....##...#
        ..##.#..##
        #.#...#...
        ..#.##..##

        Tile 2857:
        ..#.....#.
        ..#..##..#
        ##.#..#..#
        ..#..###.#
        #........#
        ...##....#
        #...#...#.
        ##.....#.#
        ##...##...
        #.#..#....

        Tile 1811:
        .#.######.
        #.......#.
        ....#..###
        ##.....#..
        ###....#..
        ..#.#..##.
        #....#..##
        #......##.
        #.#....##.
        ...#...###

        Tile 1511:
        ##.#.#####
        .....#..##
        #....#.#.#
        ..#..##..#
        #.......#.
        #..##....#
        ###.#.##.#
        #.......##
        ###...#.#.
        .##....#..

        Tile 2999:
        #####.####
        ##.......#
        ..#...#.#.
        .....#.##.
        .....#..#.
        .......###
        #.....#...
        #....#....
        #...####..
        ###.#...##

        Tile 3209:
        ..#####...
        #.#.#....#
        #...#...##
        ##........
        .....##.#.
        #..##.....
        ..#.#.##.#
        ##..##...#
        #.#......#
        #..#.#.#..

        Tile 2273:
        #####..#.#
        ...###...#
        #..##....#
        #......#.#
        ..##.....#
        ##.....#.#
        #..#..#.##
        #...##....
        ........#.
        ##.#.####.

        Tile 1583:
        #.###.##..
        .#.#.#.#..
        ........##
        ...##...#.
        ##..#.#..#
        ...#.....#
        #........#
        .....##...
        ######.###
        #.#..#.#.#

        Tile 1787:
        ###.#####.
        #...#.#..#
        #........#
        .#..##....
        ...#..#..#
        #.#...#...
        #....#....
        .#....#..#
        #.#.#....#
        ####.#.#.#

        Tile 3323:
        ###..##...
        #.....##..
        #...###...
        ##..##..##
        #..#.#.#.#
        .......##.
        #...#....#
        .....#.#..
        ..#.#..#..
        #.##.###..

        Tile 1429:
        ...##..#.#
        ..........
        ....#..#.#
        .........#
        .#.......#
        .##....#..
        ...#.#..#.
        .#.#..#..#
        ####.##...
        #.#######.

        Tile 3221:
        ...#..#..#
        #..#..##..
        ....###.#.
        ######...#
        ....#..#..
        #....#.#..
        ###..#...#
        .........#
        #....##..#
        ###.#.###.

        Tile 3299:
        ###.###..#
        ...#.#.##.
        #...##....
        .....#..#.
        ...#.....#
        #.#.......
        #....#..#.
        .#.#.....#
        ...#.....#
        .##...####

        Tile 1741:
        #..##.##.#
        .##..#..##
        #.###..##.
        #.......#.
        ##.....#.#
        #..#.#....
        ##.#..##..
        ####.##.##
        #........#
        .###.#...#

        Tile 1063:
        ##.##...#.
        .#..##....
        ...#...#..
        #.#.....##
        .##....#..
        #.#.#.....
        ####.#..##
        .#.##.....
        .#.##....#
        #.#..##.#.

        Tile 2381:
        ...####.##
        #.#.##...#
        ....#.....
        .#..#.##.#
        ##.###.#..
        ###......#
        #.....#...
        ##.####...
        ..#...####
        #.####.##.

        Tile 3463:
        .###.#.#..
        ####.#.###
        .#..#.....
        ##........
        #.##...#.#
        .#........
        #...#...#.
        ......#..#
        ##.#..#...
        ..#..#..##

        Tile 2063:
        #..#.#.###
        #.##.....#
        ..#....#..
        .#...#..##
        .####...##
        ##..##.#..
        .........#
        ..##......
        #....#...#
        ...##...#.

        Tile 1487:
        ##..##.###
        #........#
        ....#....#
        .....#..##
        #....#....
        #.#...#.#.
        #....#.#..
        .#..##...#
        .#...#.#.#
        #..####.#.

        Tile 2243:
        .#..#.#.#.
        ###...#...
        ...##.....
        .#...###..
        .#.#..##..
        #..###..##
        ..#..##.##
        ..##.....#
        ....#.#...
        .....#####

        Tile 1657:
        ##...#.#..
        #...####..
        #...##.#..
        ......#.##
        ..#.....##
        ###....###
        ##.#.##...
        .#.#...#..
        #........#
        ..####.###

        Tile 2081:
        ########..
        #.#.#...##
        #.#...#...
        ###.#.#.#.
        #.......#.
        ...#.#....
        ##........
        #.##.#..#.
        #.###.....
        ..#.#.###.

        Tile 2287:
        ######..##
        #......#..
        ....#.....
        #..#.#....
        ##...#....
        #..#....##
        #....#....
        #.........
        #..#....#.
        ......###.

        Tile 1181:
        .####.##.#
        ..#....###
        #.........
        .....#....
        .##..#.##.
        #####..#..
        ...#..###.
        ##...#.#..
        #..#.##...
        ..#.#....#

        Tile 3041:
        ##..#.####
        #..#....#.
        #.#..#..#.
        #....#...#
        #........#
        #.....#...
        ##..#.....
        ..####..#.
        ..##....##
        .#.####.##

        Tile 1319:
        ###.#...##
        ##....#...
        .....##.##
        ...#.###.#
        #......#..
        ##..#.....
        ##...##.#.
        ...#...#..
        #.###.#.#.
        .######...

        Tile 3271:
        ...##.####
        #.......#.
        .#........
        #......#.#
        ..#..#..##
        #.##.....#
        ...#..#.#.
        .####..###
        .....##..#
        .#.##..##.

        Tile 1279:
        #..#.#.#..
        #.##..#..#
        ##....#..#
        ..#.#....#
        #.#...#...
        .##....#..
        ###.#....#
        ....#...#.
        .#....#.#.
        ########..

        Tile 2029:
        .#.....#.#
        ##.#.....#
        ..##....#.
        .#.###.#..
        .#....#.#.
        #........#
        .......###
        #......##.
        ..#.#.#...
        #..#..#.##

        Tile 3361:
        ###.#.#.#.
        ...#...#..
        #.#.#....#
        #.......#.
        ....#..##.
        #.##....##
        ..##..#.##
        #..#...#.#
        ..#...#..#
        ..##.##..#

        Tile 3889:
        ####.##.#.
        #..#....#.
        ...##....#
        #...#...#.
        ..#......#
        ..####...#
        #.#..####.
        ##.......#
        ...#...#.#
        #.#...##.#

        Tile 2459:
        ...#.#.#.#
        ..#......#
        ...##.#...
        .#..##...#
        .#...#..##
        .#....#..#
        ##.......#
        ##.#......
        #.#.#.##.#
        ##..#.###.

        Tile 1951:
        .#.###.###
        ...#.#.###
        #.......#.
        ..##.....#
        ...#...#..
        #.#..##...
        #.##......
        #..#.###..
        ...###...#
        #.....####

        Tile 1627:
        #.##......
        #.#..#.#..
        .##.......
        .###....##
        ##..#..#..
        ..#....#.#
        .##..#....
        ##.#.#....
        ##.......#
        .##.#.#..#

        Tile 1297:
        ##.#...#..
        #....#.#.#
        .......#..
        ##......#.
        #...#.....
        #........#
        .....#.#.#
        .#....#.#.
        #..#..#..#
        ########.#

        Tile 3989:
        ...#......
        ....#...#.
        ###.......
        .#...###.#
        ##.#......
        .#..#....#
        .#...#.#.#
        ..#####..#
        ##....##.#
        .#.#...###

        Tile 3779:
        #.#.##.#..
        #.#......#
        ...#.....#
        .#...#.#..
        ...##.#...
        #..#..##.#
        #....##...
        ###.#....#
        .##..##..#
        ...##....#

        Tile 3769:
        ....#..#..
        ##.#....#.
        .#.##..#.#
        #.##.#..##
        ....#.##..
        #.....##..
        #....##.#.
        #.#.###.#.
        ##.#.###.#
        .#...##...

        Tile 3803:
        #..#######
        .#..###...
        ..#..#.###
        ##..#.#...
        .###.....#
        ##........
        #######...
        #.#.##....
        ....#....#
        ##....#.#.

        Tile 1777:
        ..#.##.##.
        #.....#..#
        ....#..##.
        ..#..#...#
        #....###.#
        #....#..#.
        .........#
        #.....#..#
        #.....#.#.
        ##.###..##

        Tile 1663:
        #.##..###.
        #..#.#...#
        .....#...#
        ..##.##...
        #..##.....
        #...#..#.#
        #...#.#...
        ##.#.#...#
        #.####...#
        ......#..#

        Tile 3329:
        ..##.#...#
        .#........
        ..##..##..
        #...##.###
        #.#.#..#.#
        #..#.#...#
        .....#.###
        .##..#.#.#
        .###..##..
        #####....#

        Tile 1459:
        .#.....###
        ..........
        #....#....
        ........#.
        ...##..###
        ...#......
        .#..#.##.#
        ..#..#.###
        #.#......#
        .#.#...###

        Tile 3343:
        .##.##....
        .##.#.####
        #..#..#.#.
        #.###....#
        ..#..#....
        #.......##
        #.#....##.
        #........#
        ...#...#.#
        ...##...##

        Tile 3793:
        ##.##....#
        ..##.....#
        #..#..##.#
        #...###.##
        ##........
        #......#.#
        .##....#..
        #.#.#.....
        ...#....#.
        #...##.###

        Tile 3527:
        ###.#....#
        #.#.##.#..
        .#...#....
        .........#
        #......#.#
        #.......##
        ...#.#....
        ....#...#.
        #.....#.##
        .#.######.

        Tile 1721:
        .###.#..##
        #.###....#
        #.#.#....#
        ##.#....#.
        #.#...#..#
        .#..#####.
        ##.#......
        ..#.###.#.
        #......#.#
        #.##....#.

        Tile 2357:
        ##.##.#..#
        ..#.....#.
        ...#.#....
        ##.......#
        #.#.#..#.#
        #.#...#.##
        ##.....#..
        #.....#...
        #..##.....
        #..######.

        Tile 2207:
        .##...###.
        ##..#.#.##
        ##..###..#
        ..#.###.##
        ...###...#
        #..#.....#
        .#.###....
        .#..#.#...
        #####...#.
        .#...#...#

        Tile 2633:
        ##.#.....#
        .....#..##
        ......#.##
        #........#
        ...###....
        ..#.#..#.#
        #....#...#
        ##...#..#.
        .#..#..###
        ######.##.

        Tile 3253:
        ##...#.#..
        .##.###.#.
        #.......#.
        ....###..#
        ##.#..#...
        ...#.....#
        #.....##.#
        ....#.....
        ##..##.#..
        ##..##.#.#

        Tile 2293:
        #.#..#...#
        #.......##
        #.#.#....#
        #...##.##.
        #.##.#....
        #..#.#....
        #.#.......
        #........#
        #........#
        .#.#......

        Tile 2671:
        ##.#.#...#
        ..##...#..
        ####...#..
        ##....#...
        #...#....#
        .....#..#.
        .#.#..#.##
        ###.####.#
        #.####.#.#
        ###.###.#.

        Tile 3119:
        ........#.
        ...##...#.
        #.#....##.
        .#...#....
        ...#...##.
        .###..#..#
        .........#
        #.#....#..
        .#.......#
        ##......#.

        Tile 3413:
        .......#.#
        ##...#...#
        ......###.
        #.#.......
        ##.#.....#
        #..#....##
        ##..#...#.
        ..#.#.####
        .#.....#.#
        .....####.

        Tile 2969:
        ...######.
        .#.#....#.
        #.#....#.#
        ....###.##
        .....#.#..
        ..###..#.#
        #.##....#.
        ..###.#...
        ..#.......
        .......#.#

        Tile 2713:
        ..#.#.#...
        ...#......
        .....#....
        .###.#...#
        #..#......
        #.#.###..#
        #...##..##
        ###....##.
        ...#.##.#.
        ##..#..#.#

        Tile 2749:
        #.....#..#
        .##.#...##
        #..#....#.
        ..##..#...
        .#..##...#
        ###..#...#
        ..#....#.#
        #...##.###
        #..#.....#
        #.##..#...

        Tile 1117:
        ...#..##.#
        .....##...
        ...#.#..##
        #.#.#....#
        #.#...#...
        .#######..
        .#.#..###.
        #...#.##.#
        ##....#...
        ..####..##

        Tile 3517:
        ########.#
        ###..#.###
        #.........
        .#.....###
        ##...#...#
        .#..#..#..
        .##.####.#
        ......#..#
        .....##..#
        ...#...#.#

        Tile 1523:
        #..####.#.
        .#.....#..
        #.#.......
        ....#.....
        .....####.
        #.#....##.
        .#.....##.
        .#..#.....
        ..#...#..#
        ###...####

        Tile 2879:
        .##...#...
        ##....####
        ..###...#.
        .###.##..#
        ....##....
        ...##.....
        ##.#.#.#.#
        #.#....##.
        #..#......
        ###..#####

        Tile 3851:
        ##.#.#.#.#
        ......##..
        #....##.#.
        ##...#....
        #..#..#.#.
        ....#####.
        ###.##...#
        #...###.#.
        #........#
        .#..#..##.

        Tile 2659:
        ##...####.
        .........#
        .###..#.##
        #...###.#.
        #.##.....#
        #####...##
        ..#......#
        ##.#......
        ##...##...
        #.....####

        Tile 1171:
        #.....#.##
        .#...#....
        .#...#...#
        #...#...#.
        #....#...#
        ....#...#.
        .#..#.#.##
        #....#.#.#
        .#...#...#
        ##.......#

        Tile 2711:
        ....#.###.
        #....#.###
        #..#..#.##
        ......#.#.
        .#.#......
        #.#....#.#
        #.......##
        ...#......
        .....#.#.#
        ......#..#

        Tile 1543:
        #..#..###.
        ..#.......
        ...#.#.#.#
        #..#....#.
        #.#.#....#
        .##....###
        ..#..#...#
        ..#.#...#.
        ...#..#...
        #####..##.

        Tile 3163:
        #.#.#.##..
        ........#.
        ..##.###..
        #..#...#..
        ..#.#..#..
        #.....###.
        .#........
        ......#.#.
        ..#.#..#..
        #.##.#...#

        Tile 1249:
        #....###.#
        ..#.###...
        ##...#..##
        .#..#...#.
        #.#.......
        #......#.#
        #.......##
        ..........
        #........#
        .##.###.#.

        Tile 2003:
        #.#..#..##
        #..#.....#
        #...#.##..
        ...###.##.
        ..#.#.....
        #.##...#..
        ........##
        ###.#.#..#
        .#.....#..
        #.##.#.#..

        Tile 2129:
        #.....##..
        .#...#...#
        ...#.....#
        .....#.#.#
        ...##.#...
        #.........
        ...#.#...#
        .....##.##
        ...#..#..#
        .####.#..#

        Tile 3391:
        .#.#...#..
        #..#..#...
        ......#..#
        #..#.#.#..
        .#...##..#
        #.#..#...#
        ....#....#
        #.....#.##
        #........#
        ..##..####

        Tile 1867:
        .##..##.##
        ....#...#.
        ##.#..#...
        ..##......
        ###.....#.
        #........#
        ##.#...#.#
        .#.#..##..
        #.#...#...
        ##......#.

        Tile 1747:
        ###..##.##
        #...#.#.#.
        ..##......
        #..####...
        .#.###.##.
        #......#.#
        #...#.....
        ...##....#
        .#.#......
        #.#...##..

        Tile 3191:
        #...#...#.
        ..###.....
        #.##.#....
        .##...#...
        #.###.##..
        ##.##..###
        .###..####
        #....#..#.
        .....#....
        .##.####..

        Tile 3511:
        .##.##.###
        #.#.#.##.#
        ....#...##
        ....#...#.
        #.##.#.#..
        ##...##..#
        #.#....#.#
        #.#...#...
        ..........
        ....#.#.#.

        Tile 2657:
        ####..##.#
        .#..#...##
        ....#.##.#
        .......#..
        #.#..#....
        .#.#..#.##
        ######....
        .....##..#
        ...#..##.#
        #.#.####.#

        Tile 3697:
        #####.#..#
        #.##.#..#.
        ##.##..#..
        #.#.##..#.
        ##.####..#
        .###.....#
        .#....##.#
        ..#.##..#.
        #.........
        ##..###.#.

        Tile 1123:
        .....#...#
        #.......##
        ##.#..##.#
        ..........
        ..##......
        ...#..##.#
        ####.....#
        .##......#
        ##........
        .#.......#

        Tile 2729:
        .##....###
        #...###.#.
        ###.#...##
        #.##...#..
        ##......##
        ....#...##
        #.....#...
        #.##..###.
        ....#.#...
        #..####.##

        Tile 3533:
        ..#.##..#.
        ..##.#...#
        #....##..#
        #.....##..
        #.....#..#
        ..........
        #..#..##..
        #.....##..
        .#..##...#
        .##.#.#.#.

        Tile 3919:
        #...#.....
        #....###..
        .....###..
        ##...#...#
        .#..##....
        ..##...#.#
        .........#
        ..#.###...
        ##........
        ####.##...

        Tile 1453:
        #.....##.#
        #.......#.
        .#.#..#.##
        #....#...#
        ......##..
        ....#....#
        ..#..#..##
        ##..#.##.#
        #....##...
        #####.##.#

        Tile 3643:
        ..#.#.####
        .........#
        #...#.##.#
        ...##...##
        .#......##
        #.#....#..
        .#........
        #.#.#....#
        ####.....#
        ###.####..

        Tile 2767:
        .##..####.
        ...#...#..
        ..#......#
        ....#.####
        .#.#..#.#.
        #.....#.#.
        ##..#...#.
        #.###.#...
        #...##...#
        ...##.#.#.

        Tile 3541:
        ##.##...##
        #.....##.#
        #........#
        .#..##....
        #......#..
        ......#..#
        #....#..#.
        .#.#.#.#..
        ###..#..#.
        #.######..

        Tile 3617:
        ###..#....
        #..#......
        .......##.
        ....#...##
        #...#..#..
        .#..#...#.
        #..#.#..#.
        .........#
        #...#..#.#
        #..#.#..#.

        Tile 1229:
        .#...#.##.
        .......#..
        #.#.#.#.##
        ###..#...#
        #.#..#...#
        ...##.#..#
        .#.#......
        #....#...#
        #..#..####
        #.##..###.

        Tile 1259:
        #..##.####
        .........#
        .#...####.
        #.#..#...#
        #.#...#.##
        #...#.#.#.
        ......#..#
        #.........
        ....#.....
        .##..####.
    """.trimIndent())
    check(2231, result)
}
